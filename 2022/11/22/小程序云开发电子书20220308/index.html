<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><div id="myscoll"></div><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>微信小程序云开发 | 果のBlog</title><meta name="author" content="Guo·Hugo"><meta name="copyright" content="Guo·Hugo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1，讲解视频https:&#x2F;&#x2F;edu.csdn.net&#x2F;course&#x2F;detail&#x2F;26572 2，配套笔记配套笔记会在csdn上免费给到大家，欢迎关注，笔记会持续更新。https:&#x2F;&#x2F;blog.csdn.net&#x2F;qiushi_1990 3，支持石头哥😊3-1，源码和配套资源获取目前源码和配套的一些资源暂时不免费，如果有需要的同学可以私聊石头哥，拿米来换。 3-2，笔记电子书笔记我也有整理一套电子">
<meta property="og:type" content="article">
<meta property="og:title" content="微信小程序云开发">
<meta property="og:url" content="https://guo631.top/2022/11/22/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BA%91%E5%BC%80%E5%8F%91%E7%94%B5%E5%AD%90%E4%B9%A620220308/index.html">
<meta property="og:site_name" content="果のBlog">
<meta property="og:description" content="1，讲解视频https:&#x2F;&#x2F;edu.csdn.net&#x2F;course&#x2F;detail&#x2F;26572 2，配套笔记配套笔记会在csdn上免费给到大家，欢迎关注，笔记会持续更新。https:&#x2F;&#x2F;blog.csdn.net&#x2F;qiushi_1990 3，支持石头哥😊3-1，源码和配套资源获取目前源码和配套的一些资源暂时不免费，如果有需要的同学可以私聊石头哥，拿米来换。 3-2，笔记电子书笔记我也有整理一套电子">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2022/11/24/QEjFXh8iyPLpgZu.webp">
<meta property="article:published_time" content="2022-11-22T15:37:02.730Z">
<meta property="article:modified_time" content="2022-11-24T11:51:02.330Z">
<meta property="article:author" content="Guo·Hugo">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/11/24/QEjFXh8iyPLpgZu.webp"><link rel="shortcut icon" href="https://s2.loli.net/2022/12/06/HMtTWbGe3p6JKdC.png"><link rel="canonical" href="https://guo631.top/2022/11/22/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BA%91%E5%BC%80%E5%8F%91%E7%94%B5%E5%AD%90%E4%B9%A620220308/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-24 19:51:02'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><link rel="stylesheet" href="/css/new.css"><link rel="stylesheet" href="/css/cat.css"><link rel="stylesheet" href="https://npm.elemecdn.com/ethan4116-blog/lib/css/plane_v2.css"><link rel="stylesheet" href="/css/music.css"><link rel="stylesheet" href="/css/aplayer.css"><link rel="stylesheet" href="/css/custom.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://s2.loli.net/2022/11/23/6HAUPWfn4xk7Ld9.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> list</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s2.loli.net/2022/11/24/TPSgujEpcVfkFNn.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">果のBlog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> list</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">微信小程序云开发</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-11-22T15:37:02.730Z" title="发表于 2022-11-22 23:37:02">2022-11-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-24T11:51:02.330Z" title="更新于 2022-11-24 19:51:02">2022-11-24</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">17k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>55分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="1，讲解视频"><a href="#1，讲解视频" class="headerlink" title="1，讲解视频"></a>1，讲解视频</h2><p><a target="_blank" rel="noopener" href="https://edu.csdn.net/course/detail/26572">https://edu.csdn.net/course/detail/26572</a><br><img src="https://img-blog.csdnimg.cn/20210119093623505.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h2 id="2，配套笔记"><a href="#2，配套笔记" class="headerlink" title="2，配套笔记"></a>2，配套笔记</h2><p>配套笔记会在csdn上免费给到大家，欢迎关注，笔记会持续更新。<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qiushi_1990">https://blog.csdn.net/qiushi_1990</a><br><img src="https://img-blog.csdnimg.cn/20210118134522995.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h2 id="3，支持石头哥😊"><a href="#3，支持石头哥😊" class="headerlink" title="3，支持石头哥😊"></a>3，支持石头哥😊</h2><h3 id="3-1，源码和配套资源获取"><a href="#3-1，源码和配套资源获取" class="headerlink" title="3-1，源码和配套资源获取"></a>3-1，源码和配套资源获取</h3><p>目前源码和配套的一些资源暂时不免费，如果有需要的同学可以私聊石头哥，拿米来换。</p>
<h3 id="3-2，笔记电子书"><a href="#3-2，笔记电子书" class="headerlink" title="3-2，笔记电子书"></a>3-2，笔记电子书</h3><p>笔记我也有整理一套电子书，大家也可以私聊石头哥获取电子书版的配套笔记。电子书笔记方便后期查询知识点。<br><img src="https://img-blog.csdnimg.cn/20210118135926434.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h2 id="4，问题解答-●’◡’●"><a href="#4，问题解答-●’◡’●" class="headerlink" title="4，问题解答(●’◡’●)"></a>4，问题解答(●’◡’●)</h2><p>另外石头哥提供配套解答服务。当然了，知识付费时代石头哥解答是要米的，毕竟石头哥精力有限，石头哥也是要吃面包的。石头哥有推出包月，包年解答服务。你在学习过程中有任何问题，或者工作中遇到任何编程问题，都可以来找石头哥<br>石头哥目前可以解答如下问题</p>
<ul>
<li>小程序方面的问题</li>
<li>云开发方面的问题</li>
<li>Java，springboot，Javaweb方面的问题</li>
<li>毕设方面的问题</li>
<li>安卓app开发方面的问题</li>
<li>html+css+JavaScript方面的问题</li>
<li>前端开发的问题</li>
<li>后端开发的问题</li>
<li>面试找工作方面的问题</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/2021020516372458.png"></p>
<h1 id="一，认识小程序云开发"><a href="#一，认识小程序云开发" class="headerlink" title="一，认识小程序云开发"></a>一，认识小程序云开发</h1><h2 id="1-1，云开发简介"><a href="#1-1，云开发简介" class="headerlink" title="1-1，云开发简介"></a>1-1，云开发简介</h2><ul>
<li><p>小程序·云开发是微信团队联合腾讯云推出的专业的小程序开发服务。</p>
</li>
<li><p>开发者可以使用云开发快速开发小程序、小游戏、公众号网页等，并且原生打通微信开放能力。</p>
</li>
<li><p>开发者无需搭建服务器，可免鉴权直接使用平台提供的API进行业务开发<br>小程序</p>
</li>
<li><p>云开发又简称tcb，是微信官方给我们提供的基于腾讯云的云服务器。目前云开发包含：云数据库，云函数，云存储，云调用。后面章节会具体给大家讲解这几个。</p>
</li>
</ul>
<p>官方文档：<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html">https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html</a><br><img src="https://img-blog.csdnimg.cn/20210119094307797.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h2 id="1-2，云开发和传统服务器对比"><a href="#1-2，云开发和传统服务器对比" class="headerlink" title="1-2，云开发和传统服务器对比"></a>1-2，云开发和传统服务器对比</h2><p>云开发相对于传统服务器的优势如下表<br><img src="https://img-blog.csdnimg.cn/20210118140545909.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<p>通过上面的对比，我们可以看出，如果你想快速创建一个小程序的后台，用云开发是不错的选择。</p>
<h2 id="1-3，Serverless开发模式"><a href="#1-3，Serverless开发模式" class="headerlink" title="1-3，Serverless开发模式"></a>1-3，Serverless开发模式</h2><p>要想深入了解小程序云开发，就需要知道什么是Serverless开发模式，因为我们的小程序云开发就是采用的这个模式<br>官方视频有讲到：<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/community/business/doc/000e8697e481208a2e3b31d6a5680d">https://developers.weixin.qq.com/community/business/doc/000e8697e481208a2e3b31d6a5680d</a><br>所以我们接下来要深入了解下Serverless开发模式</p>
<h3 id="1-3-1，前端开发模式的演进"><a href="#1-3-1，前端开发模式的演进" class="headerlink" title="1-3-1，前端开发模式的演进"></a>1-3-1，前端开发模式的演进</h3><p><img src="https://img-blog.csdnimg.cn/246cc0ea2b13496c8227142068aab3fc.png"></p>
<p>上图说完了这几个阶段，可以看到，每一次前端开发模式的变化，都因某个变革性的技术而起。先是 AJAX，而后是 Node.js。那么下一个变革性的技术是什么？不言而喻，个人觉得下一代前端开发模式就是 Serverless</p>
<p>其实 Serverless 早已和前端产生了联系，只是我们可能没有感知。<br>1、CDN: 相信大家都使用过 CDN，我们开发完成之后，直接将静态文件部署到 CDN 上，通过 CDN 进行内容分发、网络加速，在这个过程中，前端不需要关心 CDN 有多少个节点、如何做负载均衡，也不需要知道 CDN 的 QPS 是多少。所以从这个角度来说，CDN 是一种 serverless 的实现。<br>2、再比如对象存储，和 CDN 一样，我们只需要将文件上传到对象存储，就可以直接使用了，不需要关心它如何存取文件、如何进行权限控制，所以对象存储对前端来说是 Serverless。<br>3、甚至一些第三方的 API 服务，也是 Serverless，因为我们使用的时候，不需要去关心服务器。</p>
<h3 id="1-3-2，什么是Serverless"><a href="#1-3-2，什么是Serverless" class="headerlink" title="1-3-2，什么是Serverless"></a>1-3-2，什么是Serverless</h3><p><img src="https://img-blog.csdnimg.cn/1ce8bb2923014ce9bd91cda1337c0244.png"><br>从技术角度来说，Serverless 就是 FaaS 和 BaaS 的结合。<br>简单来讲，FaaS（Function as a Service） 就是一些运行函数的平台，比如云开发里的云函数，阿里云的函数计算、AWS 的 Lambda 等。</p>
<p>BaaS（Backend as a Service）则是一些后端云服务，比如云开发数据库、对象存储、消息队列等。利用 BaaS，可以极大简化我们的应用开发难度。</p>
<p>Serverless 则可以理解为运行在 FaaS 中，使用了 BaaS 的函数。</p>
<h3 id="1-3-3，Serverless-的主要特点"><a href="#1-3-3，Serverless-的主要特点" class="headerlink" title="1-3-3，Serverless 的主要特点"></a>1-3-3，Serverless 的主要特点</h3><p>1、事件驱动—-函数在 FaaS 平台中，需要通过一系列的事件来驱动函数执行。<br>2、无状态—-因为每次函数执行，可能使用的都是不同的容器<br>3、无运维—-使用serverless我们不需要关心服务器，也不需要关心运维，这也是serverles思想的核心；<br>4、低成本—-使用 Serverless 成本很低，因为我们只需要为每次函数的运行付费。函数不运行，则不花钱，也不会浪费服务器资源过度</p>
<h3 id="1-3-4，serverless-开发流程"><a href="#1-3-4，serverless-开发流程" class="headerlink" title="1-3-4，serverless 开发流程"></a>1-3-4，serverless 开发流程</h3><p><img src="https://img-blog.csdnimg.cn/52f3ba4c862b4c42bc82e63799f8f143.png"><br>通过上图就可以看出<br>1，传统开发流程。<br>在传统开发流程中，我们需要前端写页面，后端工程师写接口。后端写完接口之后，把接口部署了，再进行前后端联调。联调完毕后再测试、上线。上线之后，还需要运维工程师对系统进行维护。整个过程涉及多个不同角色，链路较长，沟通协调也是一个问题。</p>
<p>2、而基于 Serverless，后端变得非常简单了，以往的后端应用被拆分为一个个函数，只需要写完函数并部署到 Serverless 服务即可，后续也不用关心任何服务器的运维操作。后端开发的门槛大幅度降低了。因此，只需要一个前端就可以完成所有的开发工作。<br>当然，前端基于 Serverless 去写后端，最好也需要具备一定的后端知识。涉及复杂的后端系统或者 Serverless 不适用的场景，还是需要后端开发</p>
<h3 id="1-3-5，serverless带来的价值"><a href="#1-3-5，serverless带来的价值" class="headerlink" title="1-3-5，serverless带来的价值"></a>1-3-5，serverless带来的价值</h3><p>1．降低运营复杂度</p>
<p>Serverless架构使软件应用和服务器实现了解耦，服务器不再是用户开发和运营应用的焦点。在应用上线前，用户无须再提前规划服务器的数量和规格。在运维过程中，用户无须再持续监控和维护具体服务器的状态，只需要关心应用的整体状态。应用运营的整体复杂度下降，用户的关注点可以更多地放在软件应用的体验和改进以及其他能带来更高业务价值的地方。<br>2．降低运营成本<br>服务器不再是用户关注的一个受管资源，运营的复杂度下降，应用运营所需要投入的时间和人力将大大降低。在最好的情况下，可以做到少数几个应用管理员即可管理一个处理海量请求的应用系统。</p>
<p>3、缩短产品的上市时间<br>在Serverless架构下，应用的功能被解构成若干个细颗粒度的无状态函数，功能与功能之间的边界变得更加清晰，功能模块之间的耦合度大大减小。这使得软件应用的开发效率更高，应用开发的迭代周期更短。</p>
<h3 id="1-3-6，基于-Serverless-的小程序开发"><a href="#1-3-6，基于-Serverless-的小程序开发" class="headerlink" title="1-3-6，基于 Serverless 的小程序开发"></a>1-3-6，基于 Serverless 的小程序开发</h3><p>1、目前国内使用 Serverless 较多的场景可能就是小程开发了。具体的实现就是小程序云开发，支付宝小程序和微信小程序都提供了云开发功能。<br>2、在传统的小程序开发中，我们需要前端进行小程序端的开发；后端进行服务端的开发。小程序的后端开发和其他的后端应用开发，本质是是一样的，需要关心应用的负载均衡、备份冗灾、监控报警等一些列部署运维操作。如果开发团队人很少，可能还需要前端去实现服务端。<br>但基于云开发，就只需要让开发者关注于业务的实现，由一个前端就能够完成整个应用的前后端开发。因为云开发将后端封装为了 BaaS 服务，并提供了对应的 SDK 给开发者，开发者可以像调用函数一样使用各种后端服务。应用的运维也转移到了提供云开发的服务商。<br>下面分别是使用支付宝云开发的一些例子，函数就是定义在 FaaS 服务中的函数。</p>
<p>负载均衡（Load Balance）其意思就是分摊到多个操作单元上进行执行，例如Web服务器、FTP服务器、企业关键应用服务器和其它关键任务服务器等，从而共同完成工作任务<br>备份冗灾：就是为了防止出现自然或者社会灭害带来的对存储设备的损害而造成对数据丢失,而采取的备份.</p>
<h3 id="1-3-7，通用-Serverless-架构"><a href="#1-3-7，通用-Serverless-架构" class="headerlink" title="1-3-7，通用 Serverless 架构"></a>1-3-7，通用 Serverless 架构</h3><p><img src="https://img-blog.csdnimg.cn/2073a7990d3b4f45b61418859111c46b.png"><br>其中最底层就是实现复杂业务的后端微服务（Backend）。然后 FaaS 层通过一系列函数实现业务逻辑，并为前端直接提供服务。对于前端开发者来说，前端可以通过编写函数的方式来实现服务端的逻辑。</p>
<p>同时不管是在后端、FaaS 还是前端，我们都可以去调用云计算平台提供的 BaaS 服务，大大降低开发难度、减少开发成本。小程序云开发，就是直接在前端调用 BaaS 服务的例子。</p>
<p>一句话总结serverless - less is more<br>使用 Serverless，我们不需要再过多关注服务端的运维，不需要关心我们不熟悉的领域，我们只需要专注于业务的开发、专注于产品的实现。我们需要关心的事情变少了，但我们能做的事情更多了。</p>
<h1 id="二，微信开发者工具的安装与使用"><a href="#二，微信开发者工具的安装与使用" class="headerlink" title="二，微信开发者工具的安装与使用"></a>二，微信开发者工具的安装与使用</h1><blockquote>
<p>工欲善其事必先利其器，我们在开发小程序之前，首先需要安装小程序开发者工具，今天就来教大家安装小程序开发者工具。</p>
</blockquote>
<h2 id="2-1，其实很简单，只需要进入小程序官网，然后点击工具，如下图所示。"><a href="#2-1，其实很简单，只需要进入小程序官网，然后点击工具，如下图所示。" class="headerlink" title="2-1，其实很简单，只需要进入小程序官网，然后点击工具，如下图所示。"></a>2-1，其实很简单，只需要进入小程序官网，然后点击工具，如下图所示。</h2><p><img src="https://img-blog.csdnimg.cn/img_convert/20682b84a9b87759db822751e0d694c6.png"><br><img src="https://img-blog.csdnimg.cn/img_convert/71d862f489ebac0076a391c6310322b2.png"><br>当然了，也可以直接通过下面链接去下载<br><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html">https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html</a></p>
<h2 id="2-2，下载安装包如下"><a href="#2-2，下载安装包如下" class="headerlink" title="2-2，下载安装包如下"></a>2-2，下载安装包如下</h2><p><img src="https://img-blog.csdnimg.cn/img_convert/c61ed94c18d4476426097fe428fb924c.png"><br>不管你是window还是mac电脑，只需要双击安装包实现安装即可。<br><img src="https://img-blog.csdnimg.cn/img_convert/c5e8f3589086565f79faa7305c3f74f4.png"><br>等待安装即可<br><img src="https://img-blog.csdnimg.cn/img_convert/ec63fb1c56f8be922a8d9181b2527d76.png"><br>安装完成<br><img src="https://img-blog.csdnimg.cn/img_convert/55d199b06043a3c5ecd22bcd28643784.png"></p>
<h2 id="2-3，进入开发者工具"><a href="#2-3，进入开发者工具" class="headerlink" title="2-3，进入开发者工具"></a>2-3，进入开发者工具</h2><p><img src="https://img-blog.csdnimg.cn/img_convert/afe74862d21aeac11c054fd00352cbc8.png"><br>第一次进入时，如下<br><img src="https://img-blog.csdnimg.cn/img_convert/cbd6178708ad85de0ec3c01e2bf3b1c3.png"><br>点击上图的加号，我们来创建一个新项目<br><img src="https://img-blog.csdnimg.cn/img_convert/4a8bb8b5820ee24283cb9e06cc94e69f.png"><br>完成上图的配置后，点击新建。即可创建项目。创建好以后的项目如下图所示。<br><img src="https://img-blog.csdnimg.cn/img_convert/609013f8c581a6a8b470233dfceb0558.png"><br>这样我们就完成了小程序开发者工具的安装了，后面我们就可以开始小程序的代码编写了。</p>
<h1 id="三，注册小程序"><a href="#三，注册小程序" class="headerlink" title="三，注册小程序"></a>三，注册小程序</h1><p>我们前面虽然可以用测试号创建小程序,但是测试号有很多功能会受限,比如我们接下来要讲的云开发,必须是注册小程序后才可以使用,所以今天我们就来讲讲小程序的注册.</p>
<h3 id="其实官方给的注册步骤很详细了"><a href="#其实官方给的注册步骤很详细了" class="headerlink" title="其实官方给的注册步骤很详细了"></a>其实官方给的注册步骤很详细了</h3><p><img src="https://img-blog.csdnimg.cn/img_convert/9620803e90a57d6ce600cdb5cafced2f.png"><br>官方注册文档:<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/introduction/">https://developers.weixin.qq.com/miniprogram/introduction/</a></p>
<p>微信小程序注册地址：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/">https://mp.weixin.qq.com/</a><br>进去以后点击立即注册<br><img src="https://img-blog.csdnimg.cn/20210118170514905.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<p>进入注册页面时,跟着提示一步步来就可以了<br><img src="https://img-blog.csdnimg.cn/img_convert/b4e63808210224e80f8a5ecec6d9bc6a.png"></p>
<h3 id="注意点"><a href="#注意点" class="headerlink" title="注意点:"></a>注意点:</h3><ul>
<li>如果只是学习的话,注册个人小程序即可.</li>
<li>如果想商用,想使用微信支付,取用户手机号等复杂功能,可以注册企业小程序,不过企业小程序必须有营业执照才可以注册</li>
<li>一个邮箱只能注册一个小程序</li>
<li>一个身份证可以注册5个，个人小程序</li>
<li>一个企业的营业执照可以注册50个企业小程序</li>
</ul>
<h1 id="四，云开发环境的创建与初始化"><a href="#四，云开发环境的创建与初始化" class="headerlink" title="四，云开发环境的创建与初始化"></a>四，云开发环境的创建与初始化</h1><p>今天我们就来正式的创建自己的第一个云开发项目,在创建云开发之前,有下面几个注意事项</p>
<ul>
<li>1,必须注册小程序后才可以开通云开发</li>
<li>2,一个小程序可以创建两个云开发环境</li>
</ul>
<h2 id="4-1-创建一个初始项目"><a href="#4-1-创建一个初始项目" class="headerlink" title="4-1,创建一个初始项目"></a>4-1,创建一个初始项目</h2><p>我们要开通云开发服务，必须先要进入小程序开发者工具才可以。最新版的开发者工具在创建项目时又多了一个模板选择，如果你用的是最新版的开发者工具，模板选择里就选择不使用模板即可。<br><img src="https://img-blog.csdnimg.cn/img_convert/b3e24e88eb27a664900db49daa66a684.png"></p>
<h3 id="最新版的开发工具不使用模板"><a href="#最新版的开发工具不使用模板" class="headerlink" title="最新版的开发工具不使用模板"></a>最新版的开发工具不使用模板</h3><p>如果你用的是最新版的开发者工具，创建项目时会多一个模板选择，这里一定要记得选择不使用模板。<br><img src="https://img-blog.csdnimg.cn/f07fab6c8a63440a84377800d294dbb4.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA57yW56iL5bCP55-z5aS0,size_20,color_FFFFFF,t_70,g_se,x_16"></p>
<p>和创建普通小程序一样,如上图所示,需要注意的就是这里必须要填写自己的appid,不可以用测试号. appid的获取如下图所示.<br><img src="https://img-blog.csdnimg.cn/img_convert/43386c9a0bb79a29ecf3a9bfd6ecc436.png"></p>
<h3 id="关于appid"><a href="#关于appid" class="headerlink" title="关于appid"></a>关于appid</h3><p>如果你不使用自己的appid创建项目，就会出现下面的问题，所以一定要先去注册一个小程序，然后用自己的appid。<br><img src="https://img-blog.csdnimg.cn/20210325101008281.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<p>由于云开发官方更新的太快，有些同学可能会遇到下面这样的问题</p>
<p><img src="https://img-blog.csdnimg.cn/20210325095949431.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>没有 不使用云服务 选型。这个时候该怎么办呢。石头哥也已经更新课程，给大家提供的解决方案。</p>
<h2 id="4-2，没有“不使用云服务”选型解决方案-选看"><a href="#4-2，没有“不使用云服务”选型解决方案-选看" class="headerlink" title="4-2，没有“不使用云服务”选型解决方案(选看)"></a>4-2，没有“不使用云服务”选型解决方案(选看)</h2><p>如果你出现上面的问题，再看这节，如果没出现这样的问题，直接跳过就行。<br><img src="https://img-blog.csdnimg.cn/20210325100359366.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>我在配套资料里为大家准备了一个空白项目的模板。大家只需要把这个模板下载到桌面，并解压。<br><img src="https://img-blog.csdnimg.cn/20210325100450538.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>然后点击导入，把项目导入即可。<br><img src="https://img-blog.csdnimg.cn/20210325100640731.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>然后如下所示，记得appid换成你自己的。<br><img src="https://img-blog.csdnimg.cn/20210325100727557.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h2 id="4-3-开通云开发"><a href="#4-3-开通云开发" class="headerlink" title="4-3,开通云开发"></a>4-3,开通云开发</h2><ul>
<li>1,点击下图箭头所示,如果你第一步创建项目时,没有使用自己的appid,这里不会有下图箭头所示的云朵.<br><img src="https://img-blog.csdnimg.cn/img_convert/f28c71198f399293ebd266a1f2211c1c.png"></li>
<li>2,给云开发环境取名<br><img src="https://img-blog.csdnimg.cn/img_convert/023a13f0eaa1e9c6db839570adc791c5.png"><br>等待创建<br><img src="https://img-blog.csdnimg.cn/img_convert/4e0a7c2e116e9bf6d5154140351e7a48.png"><br>创建成功<br><img src="https://img-blog.csdnimg.cn/img_convert/3fb52c3abacfbcb4f7b1f877f485f96c.png"></li>
<li>3,获取云开发环境id<br><img src="https://img-blog.csdnimg.cn/img_convert/c37ed1928a12e773d4782e2f3fee97c2.png"></li>
</ul>
<h2 id="4-4-初始化云开发环境-重要"><a href="#4-4-初始化云开发环境-重要" class="headerlink" title="4-4,初始化云开发环境(***重要)"></a>4-4,初始化云开发环境(***重要)</h2><p>在app.js里写入环境id,注意这里要用你自己的云开发环境id</p>
<ul>
<li><p>初始化云开发环境前，先去云开发控制台，拿到云开发环境id，如下图<br><img src="https://img-blog.csdnimg.cn/20210118133235647.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>这里的环境id建议直接复制，不要手写，很容易写错。</p>
</li>
<li><p>拿到环境id以后，就去app.js里做云开发环境初始化，如下<br><img src="https://img-blog.csdnimg.cn/20210119142708111.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
</li>
</ul>
<p>用时候云开发创建好以后,初始化可能需要一点时间,所以如果这里初始化有报错,记得关闭开发者工具,等几分钟再重新打开即可.</p>
<h1 id="五，云开发-云数据库"><a href="#五，云开发-云数据库" class="headerlink" title="五，云开发~云数据库"></a>五，云开发~云数据库</h1><p>官方文档：<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/database/init.html">https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/database/init.html</a></p>
<h2 id="5-1，在数据库里新建集合-数据表"><a href="#5-1，在数据库里新建集合-数据表" class="headerlink" title="5-1，在数据库里新建集合(数据表)"></a>5-1，在数据库里新建集合(数据表)</h2><p>我们这里以新建一个商品列表为例<br><img src="https://img-blog.csdnimg.cn/20210119143131206.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h2 id="5-2，数据库权限管理"><a href="#5-2，数据库权限管理" class="headerlink" title="5-2，数据库权限管理"></a>5-2，数据库权限管理</h2><p>要想让用户查询到我们创建的商品数据，需要把权限改为所有用户可读<br><img src="https://img-blog.csdnimg.cn/20210119144339469.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h2 id="5-3，数据库的增删改查"><a href="#5-3，数据库的增删改查" class="headerlink" title="5-3，数据库的增删改查"></a>5-3，数据库的增删改查</h2><h3 id="5-3-1，查询-get"><a href="#5-3-1，查询-get" class="headerlink" title="5-3-1，查询 get()"></a>5-3-1，查询 get()</h3><ul>
<li><p>传统写法<br><img src="https://img-blog.csdnimg.cn/2021011914394249.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70" alt=" "></p>
</li>
<li><p>ES6简洁写法<br><img src="https://img-blog.csdnimg.cn/20210119145203891.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br><strong>推荐第二种写法</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210119150828859.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
</li>
</ul>
<h3 id="5-3-2，条件查询-where"><a href="#5-3-2，条件查询-where" class="headerlink" title="5-3-2，条件查询 where()"></a>5-3-2，条件查询 where()</h3><p><img src="https://img-blog.csdnimg.cn/2021011915165530.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="5-3-3，查询单条数据doc"><a href="#5-3-3，查询单条数据doc" class="headerlink" title="5-3-3，查询单条数据doc()"></a>5-3-3，查询单条数据doc()</h3><p>doc是用来查询单条数据的。比如商品详情页。<br>doc里面用到的参数就是我们数据里的_id字段<br><img src="https://img-blog.csdnimg.cn/20210120105842707.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="5-3-4，添加数据-add"><a href="#5-3-4，添加数据-add" class="headerlink" title="5-3-4，添加数据 add()"></a>5-3-4，添加数据 add()</h3><p>通过add可以实现数据的添加，<br><img src="https://img-blog.csdnimg.cn/2021012011072216.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="5-3-5，更新数据update"><a href="#5-3-5，更新数据update" class="headerlink" title="5-3-5，更新数据update()"></a>5-3-5，更新数据update()</h3><p>修改数据库里已存在的数据，结合doc进行修改单条数据<br><img src="https://img-blog.csdnimg.cn/20210120111452950.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="5-3-6，删除数据remove"><a href="#5-3-6，删除数据remove" class="headerlink" title="5-3-6，删除数据remove()"></a>5-3-6，删除数据remove()</h3><p>删除数据，结合doc删除单条数据<br><img src="https://img-blog.csdnimg.cn/20210120111942981.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h2 id="5-4，增删改查综合案例"><a href="#5-4，增删改查综合案例" class="headerlink" title="5-4，增删改查综合案例"></a>5-4，增删改查综合案例</h2><ul>
<li>1，能查看商品列表</li>
<li>2，更动态添加商品</li>
<li>3，能进入商品详情页</li>
<li>4，能删除某个商品</li>
<li>5，能修改某个商品的价格</li>
</ul>
<h3 id="5-4-1-列表跳详情-data"><a href="#5-4-1-列表跳详情-data" class="headerlink" title="5-4-1 列表跳详情 data-"></a>5-4-1 列表跳详情 data-</h3><ul>
<li>1，在wxml里定义data- 要绑定的数据<br><img src="https://img-blog.csdnimg.cn/20210120115030960.png"></li>
<li>2， 在js页面里的点击方法里拿到绑定的数据<br><img src="https://img-blog.csdnimg.cn/20210120115046577.png"></li>
<li>比如打印结果如下<br><img src="https://img-blog.csdnimg.cn/20210120115105901.png" alt="在这里插入图片描述"></li>
</ul>
<h3 id="5-4-2，列表跳详情并携带商品id"><a href="#5-4-2，列表跳详情并携带商品id" class="headerlink" title="5-4-2，列表跳详情并携带商品id"></a>5-4-2，列表跳详情并携带商品id</h3><ul>
<li>1，列表跳页到详情页<br><img src="https://img-blog.csdnimg.cn/20210120115627866.png"></li>
<li>2，拿到列表跳页时携带的id数据<br><img src="https://img-blog.csdnimg.cn/20210120115911259.png"></li>
</ul>
<h3 id="5-4-3，查询商品列表"><a href="#5-4-3，查询商品列表" class="headerlink" title="5-4-3，查询商品列表"></a>5-4-3，查询商品列表</h3><p><img src="https://img-blog.csdnimg.cn/20210121105411410.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="5-4-4，添加商品并刷新商品列表"><a href="#5-4-4，添加商品并刷新商品列表" class="headerlink" title="5-4-4，添加商品并刷新商品列表"></a>5-4-4，添加商品并刷新商品列表</h3><p><img src="https://img-blog.csdnimg.cn/20210121105450835.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="5-4-5，更新商品数据"><a href="#5-4-5，更新商品数据" class="headerlink" title="5-4-5，更新商品数据"></a>5-4-5，更新商品数据</h3><p>用户输入新价格，调用update方法进行更新数据<br><img src="https://img-blog.csdnimg.cn/20210121111158518.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>我们更新成功的时候，会有如下所示的日志打印。<br><img src="https://img-blog.csdnimg.cn/20210122103005208.png"><br>只有stats里的updated是1的时候，才代表成功的更新了一条数据。<br>如果这条商品不是你创建的，当你对这条商品做更新操作时，打印的updated就是0。<br><img src="https://img-blog.csdnimg.cn/20210122103355106.png"><br>这个时候代表没有更新成功。这是因为操作时的权限问题，要解决这个问题，就要借助云函数了，这里我们先放在这里，在后面云函数章节会做具体讲解。</p>
<h3 id="5-4-6，弹窗提示确认是否删除"><a href="#5-4-6，弹窗提示确认是否删除" class="headerlink" title="5-4-6，弹窗提示确认是否删除"></a>5-4-6，弹窗提示确认是否删除</h3><p>用户删除数据是一个危险操作，所以操作之前最好给用户一个友好提示。<br>官方弹窗文档：<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/ui/interaction/wx.showModal.html">https://developers.weixin.qq.com/miniprogram/dev/api/ui/interaction/wx.showModal.html</a></p>
<p><img src="https://img-blog.csdnimg.cn/20210122165835203.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="5-4-7，删除商品"><a href="#5-4-7，删除商品" class="headerlink" title="5-4-7，删除商品"></a>5-4-7，删除商品</h3><p><img src="https://img-blog.csdnimg.cn/202101221714103.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="5-4-8，更新和删除时的权限问题"><a href="#5-4-8，更新和删除时的权限问题" class="headerlink" title="5-4-8，更新和删除时的权限问题"></a>5-4-8，更新和删除时的权限问题</h3><p>如果这条商品不是你创建的，当你对这条商品做删除或者更新操作时，虽然也会返回成功，但是可以看到我们更新或者删除的条数是0。<br><img src="https://img-blog.csdnimg.cn/20210122103703603.png"><br><img src="https://img-blog.csdnimg.cn/202101221715036.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<p>其实这个时候也意味着没有更新或者删除成功，<strong>这里是因为操作权限的问题，因为这条数据不是你创建的</strong>。所以你只能对这条数据做查询操作，而不能做修改和删除操作。要想解决这个问题，就要借助云函数了。后面云函数讲解的部分，我会做具体讲解的。</p>
<p><strong>我们还是先接着学习数据库操作的高级操作</strong></p>
<h2 id="5-6，常用快捷键"><a href="#5-6，常用快捷键" class="headerlink" title="5-6，常用快捷键"></a>5-6，常用快捷键</h2><p>我们在开发时为了提高代码编写效率，通常会使用一些快捷键。我们小程序开发工具里常用的快捷键如下。<br>设置—》快捷键设置<br><img src="https://img-blog.csdnimg.cn/20210125095202434.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>然后点击如下快捷键即可查看所有的快捷键<br><img src="https://img-blog.csdnimg.cn/20210125095333791.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>如果感觉默认的快捷键不喜欢，可以自己重新设置快捷键。由于自带的快捷比较多，我这里不一一列举了，我把一些常用的快捷键拿出来给大家大致讲一讲，我这里以window电脑为例，如果你mac电脑，可以自己去看下开发者工具默认的快捷键。多看几遍把常用的记住就行了。</p>
<table>
<thead>
<tr>
<th>快捷键组合</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>Ctrl+a</td>
<td>全选</td>
</tr>
<tr>
<td>Ctrl+c</td>
<td>复制选中内容</td>
</tr>
<tr>
<td>Ctrl+v</td>
<td>粘贴复制的内容</td>
</tr>
<tr>
<td>Ctrl+z</td>
<td>撤销当前编辑</td>
</tr>
<tr>
<td>Ctrl+s</td>
<td>保存并编译项目</td>
</tr>
<tr>
<td>Ctrl+b</td>
<td>重新编译项目</td>
</tr>
<tr>
<td>Ctrl+x</td>
<td>截切选中的内容</td>
</tr>
<tr>
<td>Ctrl+&#x2F;</td>
<td>添加注释</td>
</tr>
<tr>
<td>Ctrl+Shift+k</td>
<td>删除当前行</td>
</tr>
<tr>
<td>Ctrl+Shift+f</td>
<td>全局搜索</td>
</tr>
<tr>
<td>Ctrl+f</td>
<td>当前页面内搜索</td>
</tr>
<tr>
<td>Ctrl+Shift+h</td>
<td>全局搜索并替换文本</td>
</tr>
<tr>
<td>Ctrl+h</td>
<td>当前页面内搜索并替换文本</td>
</tr>
<tr>
<td>Shift+Alt+F</td>
<td>格式化代码</td>
</tr>
<tr>
<td>Shift+Alt+⬆</td>
<td>向上复制当前行</td>
</tr>
<tr>
<td>Shift+Alt+⬇</td>
<td>向下复制当前行</td>
</tr>
<tr>
<td>Alt+⬆</td>
<td>把当前行向上移动一行</td>
</tr>
<tr>
<td>Alt+⬇</td>
<td>把当前行向下移动一行</td>
</tr>
</tbody></table>
<p>有的电脑上快捷键可能会有细微差距，以开发者工具默认自带的快捷键为准。</p>
<h2 id="5-7，数据库排序orderBy"><a href="#5-7，数据库排序orderBy" class="headerlink" title="5-7，数据库排序orderBy"></a>5-7，数据库排序orderBy</h2><p>orderBy方法在做排序的时候，接受两个参数</p>
<ul>
<li>1，根据那个字段排序</li>
<li>2，排序规则（升序或者降序）。升序用asc，降序用desc</li>
</ul>
<p>如我们根据商品价格从低到高升序排列<br><img src="https://img-blog.csdnimg.cn/20210125110343465.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>如我们根据商品价格从高到低降序排列<br><img src="https://img-blog.csdnimg.cn/20210125110402219.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h2 id="5-8，返回指定条数的数据limit"><a href="#5-8，返回指定条数的数据limit" class="headerlink" title="5-8，返回指定条数的数据limit"></a>5-8，返回指定条数的数据limit</h2><p>limit用来指定查询结果集数量上限，比如我们有100条数据，只想返回前20条，我们可以通过limit(20)来指定只返回20条数据。</p>
<p>例如，只返回3条数据的写法如下<br><img src="https://img-blog.csdnimg.cn/20210125111539268.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<ul>
<li>注意：limit 在小程序端默认及最大上限为 20，在云函数端默认及最大上限为 1000</li>
</ul>
<h2 id="5-9，分页方法skip"><a href="#5-9，分页方法skip" class="headerlink" title="5-9，分页方法skip"></a>5-9，分页方法skip</h2><p>skip指定查询返回结果时从指定序列后的结果开始返回，常用于分页。比如我们有100条数据，想从第10条开始返回数据，可以通过skip(10)来实现</p>
<ul>
<li>skip结合我们上面学的limit方法可以实现分页效果<br><img src="https://img-blog.csdnimg.cn/20210125112437110.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></li>
</ul>
<p>比如我们有100条数据，每次返回20条数据。那么就可以分5页返回。</p>
<ul>
<li>第1页 limit(20).skip(0)</li>
<li>第2页 limit(20).skip(20)</li>
<li>第3页 limit(20).skip(40)</li>
<li>第4页 limit(20).skip(60)</li>
<li>第5页 limit(20).skip(80)</li>
</ul>
<h2 id="5-10，Command数据库操作符"><a href="#5-10，Command数据库操作符" class="headerlink" title="5-10，Command数据库操作符"></a>5-10，Command数据库操作符</h2><p>我门上面学完了数据库的增删改查，但是这些都是最基础最简单的操作，如果我们想实现复杂的数据查询操作，该怎么办呢<br>比如</p>
<ul>
<li>查询价格大于100的商品？</li>
<li>查询年龄小于18岁的学生？</li>
<li>如何同时修改多条数据？</li>
<li>如何同时删除多条数据？</li>
</ul>
<p>我们如果想实现上面这些复杂的操作，就需要用到数据库里的 Command数据库操作符，就是下面这位<br><img src="https://img-blog.csdnimg.cn/2021012009455233.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>官方文档：<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/Command.html">https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/Command.html</a></p>
<h3 id="5-10-1，gt查询大于指定值的数据"><a href="#5-10-1，gt查询大于指定值的数据" class="headerlink" title="5-10-1，gt查询大于指定值的数据"></a>5-10-1，gt查询大于指定值的数据</h3><p>比如查询价格大于5的所有商品<br><img src="https://img-blog.csdnimg.cn/20210127165116544.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="5-10-2，gte查询大于等于指定值的数据"><a href="#5-10-2，gte查询大于等于指定值的数据" class="headerlink" title="5-10-2，gte查询大于等于指定值的数据"></a>5-10-2，gte查询大于等于指定值的数据</h3><p>比如查询大于等于5元的商品<br><img src="https://img-blog.csdnimg.cn/20210127165315512.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="5-10-3，lt查询小于指定数值的数据"><a href="#5-10-3，lt查询小于指定数值的数据" class="headerlink" title="5-10-3，lt查询小于指定数值的数据"></a>5-10-3，lt查询小于指定数值的数据</h3><p>比如查询价格小于5的所有商品<br><img src="https://img-blog.csdnimg.cn/20210127165629116.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="5-10-4，lte查询小于等于指定数值的数据"><a href="#5-10-4，lte查询小于等于指定数值的数据" class="headerlink" title="5-10-4，lte查询小于等于指定数值的数据"></a>5-10-4，lte查询小于等于指定数值的数据</h3><p>比如查询价格小于等于5元的所有商品<br><img src="https://img-blog.csdnimg.cn/20210127165656903.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="5-10-5，and同时满足多个条件的查询"><a href="#5-10-5，and同时满足多个条件的查询" class="headerlink" title="5-10-5，and同时满足多个条件的查询"></a>5-10-5，and同时满足多个条件的查询</h3><p>比如查询价格大于5小于10元的所有商品<br><img src="https://img-blog.csdnimg.cn/20210127171011932.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h1 id="六，云开发-云函数"><a href="#六，云开发-云函数" class="headerlink" title="六，云开发~云函数"></a>六，云开发~云函数</h1><h2 id="6-1，认识云函数"><a href="#6-1，认识云函数" class="headerlink" title="6-1，认识云函数"></a>6-1，认识云函数</h2><p>官方文档：<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/functions.html">https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/functions.html</a></p>
<p>我们先来看下官方给出的云函数简介<br><img src="https://img-blog.csdnimg.cn/20210128101348674.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>其实通俗来讲，云函数也是运行在服务器上的，只不过和我们传统开发语言相比。微信官方为我们提供的傻瓜式的一键部署。也就是说你只需要把心思花在业务逻辑代码的编写上即可。无需关心写好如何部署，无需关心安全问题，无需关心鉴权问题。</p>
<p>我们下面以获取openid为例，来看看云函数，php，Java的实现对比</p>
<ul>
<li>php获取用户openid<br><img src="https://img-blog.csdnimg.cn/20210128101816592.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>如果用php来获取openid必须经历下面几步</li>
<li>1，去小程序后台拿到appid和appSecret</li>
<li>2，请求微信的对应接口</li>
<li>3，获取数据后进行解码</li>
<li>4，购买服务器，配置服务器</li>
<li>5，购买域名，域名备案，配置https</li>
<li>6，部署php代码到服务器</li>
<li>7，小程序端调用php接口</li>
</ul>
<p>Java获取openid和上面的php步骤一样，也是需要上面7步。而我们用云函数获取openid呢，就只需要简单的3步就行了，代码量也能显著减少</p>
<h3 id="6-1-1，云函数获取openid"><a href="#6-1-1，云函数获取openid" class="headerlink" title="6-1-1，云函数获取openid"></a>6-1-1，云函数获取openid</h3><p>用云函数的话，只需要3步</p>
<ul>
<li>1，编写云函数</li>
<li>2，一键部署云函数</li>
<li>3，调用云函数</li>
</ul>
<p>来看下云函数代码，只需要10行代码，即可轻松搞定<br><img src="https://img-blog.csdnimg.cn/20210128103312772.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h2 id="6-2，云函数的优势"><a href="#6-2，云函数的优势" class="headerlink" title="6-2，云函数的优势"></a>6-2，云函数的优势</h2><p>我们用云函数和上一章的云数据库进行下对比</p>
<table>
<thead>
<tr>
<th>操作</th>
<th>云函数</th>
<th>云数据库</th>
</tr>
</thead>
<tbody><tr>
<td>返回数据上限</td>
<td>100条</td>
<td>20条</td>
</tr>
<tr>
<td>更新数据</td>
<td>都可以更新</td>
<td>只有自己创建的才可以更新</td>
</tr>
<tr>
<td>删除数据</td>
<td>都可以删除</td>
<td>只有自己创建的才可以删除</td>
</tr>
<tr>
<td>运行环境</td>
<td>运行在云端Node.js环境</td>
<td>运行在小程序本地</td>
</tr>
<tr>
<td>实现功能丰富度</td>
<td>非常丰富</td>
<td>只能实现数据库增删改查</td>
</tr>
</tbody></table>
<ul>
<li>来看下官方文档是如何描述云函数的<br>云函数属于管理端，在云函数中运行的代码拥有不受限的数据库读写权限和云文件读写权限。需特别注意，云函数运行环境即是管理端，与云函数中的传入的 openId 对应的微信用户是否是小程序的管理员 &#x2F; 开发者无关。</li>
</ul>
<h2 id="6-3，云函数调用演示"><a href="#6-3，云函数调用演示" class="headerlink" title="6-3，云函数调用演示"></a>6-3，云函数调用演示</h2><p>官方文档：<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/functions/Cloud.callFunction.html">https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/functions/Cloud.callFunction.html</a></p>
<h3 id="6-3-0-初始化云函数的环境"><a href="#6-3-0-初始化云函数的环境" class="headerlink" title="6-3-0,初始化云函数的环境"></a>6-3-0,初始化云函数的环境</h3><ul>
<li>1，创建一个文件夹cloud和pages平行<br><img src="https://img-blog.csdnimg.cn/20210128112140139.png" alt="在这里插入图片描述"></li>
<li>2，在project.config.json里面配置云函数所在目录为cloud<br>在project.config.json里面添加如下配置<img src="https://img-blog.csdnimg.cn/20210128112324919.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>然后点击保存，我们的cloud文件夹前面就有一个云朵<br><img src="https://img-blog.csdnimg.cn/20210128112426173.png"><br>就代表我们云函数初始化成功啦。</li>
<li>新一个云函数<br><img src="https://img-blog.csdnimg.cn/20210128113128483.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
<li>如果只创建一个云函数的时候，会出现下面的问题。<br><img src="https://img-blog.csdnimg.cn/20210128113247938.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>解决方案：只需要在cloud文件夹下新建一个空白文件即可。</li>
</ul>
<h3 id="6-3-1，云函数获取openid"><a href="#6-3-1，云函数获取openid" class="headerlink" title="6-3-1，云函数获取openid"></a>6-3-1，云函数获取openid</h3><p>调用云函数有两种写法</p>
<ul>
<li>1，传统的success和fail<br><img src="https://img-blog.csdnimg.cn/20210128114458871.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></li>
<li>2，用promise写法then和catch<br><img src="https://img-blog.csdnimg.cn/20210128114704240.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></li>
</ul>
<h3 id="6-3-2，数据的导入和导出"><a href="#6-3-2，数据的导入和导出" class="headerlink" title="6-3-2，数据的导入和导出"></a>6-3-2，数据的导入和导出</h3><ul>
<li>数据导出，做数据备份<br><img src="https://img-blog.csdnimg.cn/20210128121013973.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>比如导入为json数据如下<br><img src="https://img-blog.csdnimg.cn/20210128121110249.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></li>
<li>数据导入，为了快速的大量的创建一些数据。<br>为了方便付费用户，我这里提前准备好了108条数据，付费用户直接去下载即可<br><img src="https://img-blog.csdnimg.cn/2021012812355978.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>把下载好的这108条数据的json文件，导入到数据库如下<br><img src="https://img-blog.csdnimg.cn/202101281236396.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></li>
</ul>
<h3 id="6-3-3，云函数获取数据"><a href="#6-3-3，云函数获取数据" class="headerlink" title="6-3-3，云函数获取数据"></a>6-3-3，云函数获取数据</h3><p>注意：云函数只要有变动，就要重新部署，否则云函数不生效。</p>
<p>遇到了一个问题，如下<br><img src="https://img-blog.csdnimg.cn/20210128115406470.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>出现原因：如果你有两个云开发环境，偶尔会出现上图所示的问题。<br>解决问题：有两种</p>
<ul>
<li>1，在云函数里指定你要使用那个云开发环境<br><img src="https://img-blog.csdnimg.cn/20210128115654705.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></li>
<li>2，<strong>使用DYNAMIC_CURRENT_ENV常量 （提倡使用这个）</strong><br><img src="https://img-blog.csdnimg.cn/20210128115926399.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>我们这里会和小程序里直接调用数据库的查询进行下对比<br><img src="https://img-blog.csdnimg.cn/20210128120452944.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20210128124103359.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="6-3-4，云函数修改数据"><a href="#6-3-4，云函数修改数据" class="headerlink" title="6-3-4，云函数修改数据"></a>6-3-4，云函数修改数据</h3><p>本地小程序直接调用数据库修改会有问题</p>
<ul>
<li><p>只能修改自己创建的数据，别人创建的数据，就没有办法修改了。<br><img src="https://img-blog.csdnimg.cn/20210129164121371.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
</li>
<li><p>如何解决呢？ 用云函数来修改就可以解决这个问题啦。</p>
</li>
<li><p>1，先创建云函数update0129<br><img src="https://img-blog.csdnimg.cn/20210129164236714.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
</li>
<li><p>2,调用云函数就行修改<br><img src="https://img-blog.csdnimg.cn/20210129164221501.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
</li>
</ul>
<h3 id="6-3-5，云函数删除数据"><a href="#6-3-5，云函数删除数据" class="headerlink" title="6-3-5，云函数删除数据"></a>6-3-5，云函数删除数据</h3><ul>
<li>1,创建一个删除商品的云函数remove0129<br><img src="https://img-blog.csdnimg.cn/20210129165537372.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></li>
<li>2,调用这个云函数进行删除操作<br><img src="https://img-blog.csdnimg.cn/20210129165609854.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></li>
</ul>
<h3 id="6-3-6，提交数据到云函数"><a href="#6-3-6，提交数据到云函数" class="headerlink" title="6-3-6，提交数据到云函数"></a>6-3-6，提交数据到云函数</h3><ul>
<li>1，创建云函数，并部署<br><img src="https://img-blog.csdnimg.cn/20210129170423649.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></li>
<li>2，调用云函数<br><img src="https://img-blog.csdnimg.cn/20210129170445839.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></li>
</ul>
<h2 id="6-4-使用云函数常见问题"><a href="#6-4-使用云函数常见问题" class="headerlink" title="6-4,使用云函数常见问题"></a>6-4,使用云函数常见问题</h2><h3 id="6-4-1，云函数里面没有初始化环境变量"><a href="#6-4-1，云函数里面没有初始化环境变量" class="headerlink" title="6-4-1，云函数里面没有初始化环境变量"></a>6-4-1，云函数里面没有初始化环境变量</h3><p><img src="https://img-blog.csdnimg.cn/20210129165211243.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>解决方案如下：<br>使用DYNAMIC_CURRENT_ENV<br><img src="https://img-blog.csdnimg.cn/20210129165244946.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>代码片段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cloud.init(&#123;</span><br><span class="line">  env: cloud.DYNAMIC_CURRENT_ENV </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h1 id="七，云开发-云存储"><a href="#七，云开发-云存储" class="headerlink" title="七，云开发~云存储"></a>七，云开发~云存储</h1><p>首先来看下官方对云存储的介绍：<br>官方文档：<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/storage.html">https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/storage.html</a><br><img src="https://img-blog.csdnimg.cn/20210201161044364.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>说白了，云存储就是可以用来存储视频，音频，图片，文件的一个云存储空间。如果你的小程序需要用到视频播放，音频播放，图片展示，文件上传与下载功能，就可以用到我们的云存储了。</p>
<ul>
<li>使用云存储来存储文件时，文件名的命名有一些规则，建议看一下。<br><img src="https://img-blog.csdnimg.cn/20210201162210831.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></li>
</ul>
<h2 id="7-1，云开发控制台管理文件"><a href="#7-1，云开发控制台管理文件" class="headerlink" title="7-1，云开发控制台管理文件"></a>7-1，云开发控制台管理文件</h2><p>控制台也可以很方便的管理文件。<br><img src="https://img-blog.csdnimg.cn/20210202111303938.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h2 id="7-2，上传图片到云存储"><a href="#7-2，上传图片到云存储" class="headerlink" title="7-2，上传图片到云存储"></a>7-2，上传图片到云存储</h2><p>我们上传图片之前需要先选择图片，所以这里用到一个图片选择的功能<br><img src="https://img-blog.csdnimg.cn/20210201162803725.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>对应的官方文档：<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.chooseImage.html">https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.chooseImage.html</a><br><img src="https://img-blog.csdnimg.cn/20210201162833775.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>然后调用文件上传的api接口即可<br><img src="https://img-blog.csdnimg.cn/20210201163026521.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>官方文档：<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/storage/uploadFile/client.uploadFile.html">https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/storage/uploadFile/client.uploadFile.html</a></p>
<h2 id="7-3，给商品列表加商品图片"><a href="#7-3，给商品列表加商品图片" class="headerlink" title="7-3，给商品列表加商品图片"></a>7-3，给商品列表加商品图片</h2><p>我们既然已经学完图片上传功能了，那么我们就可以改造下我们之前的商品列表了，给我们的商品列表添加商品图片。<br><img src="https://img-blog.csdnimg.cn/20210202172602566.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h2 id="7-4，上传视频到云存储"><a href="#7-4，上传视频到云存储" class="headerlink" title="7-4，上传视频到云存储"></a>7-4，上传视频到云存储</h2><p>上传视频之前同样需要先选择视频，选择视频的代码如下<br><img src="https://img-blog.csdnimg.cn/20210201163512755.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>对应的官方文档如下：<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/media/video/wx.chooseVideo.html">https://developers.weixin.qq.com/miniprogram/dev/api/media/video/wx.chooseVideo.html</a><br><img src="https://img-blog.csdnimg.cn/20210201163541479.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>选择好视频以后，同样是调用文件上传api，因为视频也是一个文件。<br><img src="https://img-blog.csdnimg.cn/2021020116363179.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h2 id="7-5，上传word，excel文件到云存储"><a href="#7-5，上传word，excel文件到云存储" class="headerlink" title="7-5，上传word，excel文件到云存储"></a>7-5，上传word，excel文件到云存储</h2><h3 id="7-5-1，上传之前先选择文件"><a href="#7-5-1，上传之前先选择文件" class="headerlink" title="7-5-1，上传之前先选择文件"></a>7-5-1，上传之前先选择文件</h3><p>选择文件的时候记得把type设置为file<br><img src="https://img-blog.csdnimg.cn/20210201163838790.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>对应的官方文档：<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.chooseMessageFile.html">https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.chooseMessageFile.html</a></p>
<ul>
<li>这里有一点需要注意<br>在电脑模拟器上是选择电脑上的文件，在手机上运行小程序进行选择文件时是选择你聊天记录里的文件。</li>
</ul>
<h3 id="7-5-2，上传文件"><a href="#7-5-2，上传文件" class="headerlink" title="7-5-2，上传文件"></a>7-5-2，上传文件</h3><p>在上面选择好文件以后，我们还是要调用uploadFile进行文件上传<br><img src="https://img-blog.csdnimg.cn/20210201164637337.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h2 id="7-6，下载文件"><a href="#7-6，下载文件" class="headerlink" title="7-6，下载文件"></a>7-6，下载文件</h2><p>使用wx.cloud.downloadFile下载文件<br><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-client-api/storage/downloadFile.html">https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-client-api/storage/downloadFile.html</a><br><img src="https://img-blog.csdnimg.cn/20210205163358308.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h2 id="7-7，下载并打开word，excel，pdf"><a href="#7-7，下载并打开word，excel，pdf" class="headerlink" title="7-7，下载并打开word，excel，pdf"></a>7-7，下载并打开word，excel，pdf</h2><p>使用wx.openDocument打开文件<br><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/file/wx.openDocument.html">https://developers.weixin.qq.com/miniprogram/dev/api/file/wx.openDocument.html</a><br><img src="https://img-blog.csdnimg.cn/20210205163603197.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h1 id="八，列表的下拉刷新"><a href="#八，列表的下拉刷新" class="headerlink" title="八，列表的下拉刷新"></a>八，列表的下拉刷新</h1><h2 id="8-1，开启页面下拉刷新"><a href="#8-1，开启页面下拉刷新" class="headerlink" title="8-1，开启页面下拉刷新"></a>8-1，开启页面下拉刷新</h2><p>我们需要在app.json获取页面对应的json里设置enablePullDownRefresh属性为true来开启下拉刷新。</p>
<p><img src="https://img-blog.csdnimg.cn/20210205170856209.png"><br><img src="https://img-blog.csdnimg.cn/20210205171621417.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>由于我们的刷新动画默认是白色圆点，所以还要在json里设置页面背景色才可以看到动画。<br><img src="https://img-blog.csdnimg.cn/20210205174537120.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h2 id="8-2，在Page的onPullDownRefresh里监听刷新"><a href="#8-2，在Page的onPullDownRefresh里监听刷新" class="headerlink" title="8-2，在Page的onPullDownRefresh里监听刷新"></a>8-2，在Page的onPullDownRefresh里监听刷新</h2><p><img src="https://img-blog.csdnimg.cn/20210205171045580.png"><br>在page里的onPullDownRefresh方法里监听下拉刷新<br><img src="https://img-blog.csdnimg.cn/20210205171941928.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h2 id="8-3，用户下拉刷新时请求最新数据"><a href="#8-3，用户下拉刷新时请求最新数据" class="headerlink" title="8-3，用户下拉刷新时请求最新数据"></a>8-3，用户下拉刷新时请求最新数据</h2><p><img src="https://img-blog.csdnimg.cn/2021020517250836.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h2 id="8-4，数据请求成功后停止刷新"><a href="#8-4，数据请求成功后停止刷新" class="headerlink" title="8-4，数据请求成功后停止刷新"></a>8-4，数据请求成功后停止刷新</h2><p>我们在下拉刷新时，刷新动画一般很久才结束，正常情况下应该是数据请求成功后就结束刷新动画。所以我们通过wx.stopPullDownRefresh()方法来结束刷新动画。<br>官方文档：<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/ui/pull-down-refresh/wx.startPullDownRefresh.html">https://developers.weixin.qq.com/miniprogram/dev/api/ui/pull-down-refresh/wx.startPullDownRefresh.html</a><br><img src="https://img-blog.csdnimg.cn/20210205174805866.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>代码示例如下<br><img src="https://img-blog.csdnimg.cn/20210205175925121.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h1 id="九，列表的分页加载"><a href="#九，列表的分页加载" class="headerlink" title="九，列表的分页加载"></a>九，列表的分页加载</h1><h2 id="9-1，小程序数据库每次最多20条"><a href="#9-1，小程序数据库每次最多20条" class="headerlink" title="9-1，小程序数据库每次最多20条"></a>9-1，小程序数据库每次最多20条</h2><p>小程序数据库api和云函数调用数据的限制<br>小程序端直接调用云数据库时，每次最多可以获取20条，云函数里调用云数据库时每次最多获取100条。所以我们数据多的时候要做分页加载。</p>
<h2 id="9-2，分页加载的核心方法"><a href="#9-2，分页加载的核心方法" class="headerlink" title="9-2，分页加载的核心方法"></a>9-2，分页加载的核心方法</h2><p>我们做分页加载时，主要用到了skip和limit方法，对应的官方文档如下</p>
<ul>
<li>skip：每页加载多少条<br><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.skip.html">https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.skip.html</a></li>
<li>limit: 加载第几页的数据<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.limit.html">https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.limit.html</a></li>
</ul>
<p>其实这个skip和limit我在数据库的那一节有做初步讲解，这一节我们就借助具体分页加载的案例来做综合讲解</p>
<h2 id="9-3，导入108条数据"><a href="#9-3，导入108条数据" class="headerlink" title="9-3，导入108条数据"></a>9-3，导入108条数据</h2><h3 id="9-3-1，下载数据源"><a href="#9-3-1，下载数据源" class="headerlink" title="9-3-1，下载数据源"></a>9-3-1，下载数据源</h3><p>这108条数据是石头哥提前为付费用户&#x2F;年卡用户准备好的，如果你没有付费，可以自己去数据库里创建108条数据即可。<br><img src="https://img-blog.csdnimg.cn/20210220104420742.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="9-3-2，导入到数据表"><a href="#9-3-2，导入到数据表" class="headerlink" title="9-3-2，导入到数据表"></a>9-3-2，导入到数据表</h3><p>我这里导入到num数据表，导入成功如下：<br><img src="https://img-blog.csdnimg.cn/2021022010395576.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="9-3-3，别忘记修改表权限"><a href="#9-3-3，别忘记修改表权限" class="headerlink" title="9-3-3，别忘记修改表权限"></a>9-3-3，别忘记修改表权限</h3><p>把数据表(集合)的权限改为所有用户可读，仅创建者可读写。<br><img src="https://img-blog.csdnimg.cn/20210220104538397.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h2 id="9-4，上拉加载更多监听"><a href="#9-4，上拉加载更多监听" class="headerlink" title="9-4，上拉加载更多监听"></a>9-4，上拉加载更多监听</h2><p>我们的列表滑动到最后一个数据时，会执行下面的方法<br><img src="https://img-blog.csdnimg.cn/20210222160533139.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>所以我们的分页加载要在onReachBottom里做。</p>
<h2 id="9-5，数据库分页加载代码实现"><a href="#9-5，数据库分页加载代码实现" class="headerlink" title="9-5，数据库分页加载代码实现"></a>9-5，数据库分页加载代码实现</h2><p>直接调用数据库每次最多只能加载20条数据<br><img src="https://img-blog.csdnimg.cn/20210222161602873.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>wxml里只做简单的列表数据显示就行了<br><img src="https://img-blog.csdnimg.cn/20210222161633284.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>wxss做个简单的样式<br><img src="https://img-blog.csdnimg.cn/2021022216165113.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>对应的效果如下<br><img src="https://img-blog.csdnimg.cn/2021022216171223.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="9-5-1，没有更多数据时的友好提示"><a href="#9-5-1，没有更多数据时的友好提示" class="headerlink" title="9-5-1，没有更多数据时的友好提示"></a>9-5-1，没有更多数据时的友好提示</h3><p><img src="https://img-blog.csdnimg.cn/20210224163137345.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<p><img src="https://img-blog.csdnimg.cn/20210224162947430.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="9-5-2，加载中和加载完成的友好提示"><a href="#9-5-2，加载中和加载完成的友好提示" class="headerlink" title="9-5-2，加载中和加载完成的友好提示"></a>9-5-2，加载中和加载完成的友好提示</h3><ul>
<li>加载中<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wx.showLoading(&#123;</span><br><span class="line">   title: &#x27;加载中...&#x27;,</span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure></li>
<li>隐藏加载中<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wx.hideLoading()</span><br></pre></td></tr></table></figure>
<img src="https://img-blog.csdnimg.cn/20210224163236298.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></li>
</ul>
<h2 id="9-6-通过云函数实现分页加载"><a href="#9-6-通过云函数实现分页加载" class="headerlink" title="9-6,通过云函数实现分页加载"></a>9-6,通过云函数实现分页加载</h2><p>通过云函数调用数据库，每次最多可以加载100条数据.</p>
<ul>
<li>如果每页20条以内，不建议用云函数</li>
<li>如果分页的时候，每页大于20条，就用云函数。<br><img src="https://img-blog.csdnimg.cn/20210224164952168.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></li>
</ul>
<h1 id="十，搜索功能"><a href="#十，搜索功能" class="headerlink" title="十，搜索功能"></a>十，搜索功能</h1><p>今天来给大家讲讲小程序的搜索功能。我这里后台数据库用的是小程序云开发的云数据库。所以我们搜索的时候就要借助云开发来实现。</p>
<p>注意：我们存数据的数据表(集合)要把权限改成如下所示。<br><img src="https://img-blog.csdnimg.cn/4e3ba9d1854f4b569cb2ebacf71ca29b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA57yW56iL5bCP55-z5aS0,size_20,color_FFFFFF,t_70,g_se,x_16"></p>
<h2 id="10-1，需求"><a href="#10-1，需求" class="headerlink" title="10-1，需求"></a>10-1，需求</h2><p>比如我这里有如下的一些数据<br><img src="https://img-blog.csdnimg.cn/20210207220734125.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>我有为大家准备好数据源，就在我们对应章节的视频目录下，大家可以自己一个个添加数据，当然也可以直接导入石头哥的数据源，我会在视频里教大家复习下如何导入数据到云开发数据库。<br><img src="https://img-blog.csdnimg.cn/b704ecef474e4d39be500abf92a67fae.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA57yW56iL5bCP55-z5aS0,size_20,color_FFFFFF,t_70,g_se,x_16"></p>
<p>我们想实现如下搜索需求</p>
<ul>
<li>1，搜索标题(title)包含‘小石头’的数据</li>
<li>2，搜索标题(title)或者描述(desc)包含‘小石头’的数据</li>
<li>3，搜索标题(title)描述(desc)都包含‘小石头’的数据</li>
</ul>
<p>我们知道数据库查询的时候有个where语句，但是where语句是查询某个字段全部包含你输入的内容时才可以，所以单纯用where语句来做搜索的话，结果太单一。所以我们今天就来学习下模糊搜索功能的实现。我们以上面三个需求为例，来一个个讲解。</p>
<h2 id="10-2，实现原理"><a href="#10-2，实现原理" class="headerlink" title="10-2，实现原理"></a>10-2，实现原理</h2><p>我们做模糊搜索的时候，其实就是查询某个字段里是否包含我们的搜索词。而模糊搜索需要借助RegExp，来看看RegExp是什么。<br><img src="https://img-blog.csdnimg.cn/20210207214411585.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>官方文档：<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/Database.RegExp.html">https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/Database.RegExp.html</a></p>
<ul>
<li>再来看看官方示例<br><img src="https://img-blog.csdnimg.cn/2021020721445170.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>可能看官方示例会有点糊涂，那么我们接下来就结合具体代码来给大家做下讲解。</li>
</ul>
<h2 id="10-3，模糊搜索的代码实现"><a href="#10-3，模糊搜索的代码实现" class="headerlink" title="10-3，模糊搜索的代码实现"></a>10-3，模糊搜索的代码实现</h2><h3 id="10-3-1，模糊搜索单个字段"><a href="#10-3-1，模糊搜索单个字段" class="headerlink" title="10-3-1，模糊搜索单个字段"></a>10-3-1，模糊搜索单个字段</h3><ul>
<li>需求：搜索标题(title)包含‘小石头’的数据</li>
</ul>
<p>代码如下<br><img src="https://img-blog.csdnimg.cn/20210207215202954.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>查询结果如下：<br><img src="https://img-blog.csdnimg.cn/20210207215132308.png"><br>可以看到我们成功的查询到了标题里包含‘小石头的数据’</p>
<h3 id="10-3-2，模糊搜索多个字段（满足一个即可）"><a href="#10-3-2，模糊搜索多个字段（满足一个即可）" class="headerlink" title="10-3-2，模糊搜索多个字段（满足一个即可）"></a>10-3-2，模糊搜索多个字段（满足一个即可）</h3><ul>
<li>需求：搜索标题(title)或者描述(desc)包含‘小石头’的数据</li>
</ul>
<p>由于我们要查询多个字段，所以我们这里用到了command高级操作符里的or<br><img src="https://img-blog.csdnimg.cn/20210207215716587.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>代码如下：<br><img src="https://img-blog.csdnimg.cn/20210207220123112.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>查询结果：<br><img src="https://img-blog.csdnimg.cn/20210207220051542.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>我们来分析下这两条数据</p>
<ul>
<li>1，标题和描述都包含‘小石头’，符合</li>
<li>2，虽然标题里没有‘小石头’，但是描述里有，所以也符合。</li>
<li>3，title和desc里都没有‘小石头’，所以不符合。<br><img src="https://img-blog.csdnimg.cn/20210207220816997.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></li>
</ul>
<h3 id="10-3-3，模糊搜索多个字段（要同时满足）"><a href="#10-3-3，模糊搜索多个字段（要同时满足）" class="headerlink" title="10-3-3，模糊搜索多个字段（要同时满足）"></a>10-3-3，模糊搜索多个字段（要同时满足）</h3><ul>
<li>需求：搜索标题(title)描述(desc)都包含‘小石头’的数据</li>
</ul>
<p>由于我们要查询多个字段，所以我们这里用到了command高级操作符里的and<br><img src="https://img-blog.csdnimg.cn/20210207221006673.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<p>代码如下：<br><img src="https://img-blog.csdnimg.cn/20210207220906802.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<p>查询结果：<br><img src="https://img-blog.csdnimg.cn/20210207220635299.png"><br>我们来分析下这两条数据</p>
<ul>
<li>1，标题和描述都包含‘小石头’，符合</li>
<li>2，虽然desc里没有‘小石头’，但是title里没有，所以也不符合。</li>
<li>3，title和desc里都没有‘小石头’，所以也不符合。<br><img src="https://img-blog.csdnimg.cn/20210207220746420.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></li>
</ul>
<h2 id="10-4，源码"><a href="#10-4，源码" class="headerlink" title="10-4，源码"></a>10-4，源码</h2><p>为例方便大家使用，我把完整的代码贴到这里，后面大家使用时，直接复制这里的代码，略微改造下就可以了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">//我这里简单起见就把搜索词写死，正常应该用户输入的</span><br><span class="line">let searchKey = &#x27;小石头&#x27;</span><br><span class="line">let db = wx.cloud.database()</span><br><span class="line">let _ = db.command</span><br><span class="line"></span><br><span class="line">db.collection(&#x27;news&#x27;)</span><br><span class="line">  .where(_.or([</span><br><span class="line">    &#123;//标题</span><br><span class="line">      title: db.RegExp(&#123; //使用正则查询，实现对搜索的模糊查询</span><br><span class="line">        regexp: searchKey,</span><br><span class="line">        options: &#x27;i&#x27;, //大小写不区分</span><br><span class="line">      &#125;),</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;//描述</span><br><span class="line">      desc: db.RegExp(&#123;</span><br><span class="line">        regexp: searchKey,</span><br><span class="line">        options: &#x27;i&#x27;,</span><br><span class="line">      &#125;),</span><br><span class="line">    &#125;</span><br><span class="line">  ])).get()</span><br><span class="line">  .then(res =&gt; &#123;</span><br><span class="line">    console.log(&#x27;查询成功&#x27;, res)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(res =&gt; &#123;</span><br><span class="line">    console.log(&#x27;查询失败&#x27;, res)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<h2 id="10-5，获取用户输入的搜索词显示搜索列表"><a href="#10-5，获取用户输入的搜索词显示搜索列表" class="headerlink" title="10-5，获取用户输入的搜索词显示搜索列表"></a>10-5，获取用户输入的搜索词显示搜索列表</h2><p>其实获取用户输入的内容，我们之前讲过很多遍了，就是用input组件，通过bindinput来获取用户输入的搜索词，然后点击搜索实现搜索功能。<br>要实现的效果图如下：<br><img src="https://img-blog.csdnimg.cn/6f4b9f1cb122458b8d0e4261e3318459.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA57yW56iL5bCP55-z5aS0,size_10,color_FFFFFF,t_70,g_se,x_16"><br>然后我们搜索对应的关键词以后可以显示对应的搜索结果在列表上<br><img src="https://img-blog.csdnimg.cn/1873984de1014877852c2c44dce54d18.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA57yW56iL5bCP55-z5aS0,size_10,color_FFFFFF,t_70,g_se,x_16"><br>我会在视频里带着大家一步步的实现。</p>
<h1 id="十一，云开发实现登陆注册功能"><a href="#十一，云开发实现登陆注册功能" class="headerlink" title="十一，云开发实现登陆注册功能"></a>十一，云开发实现登陆注册功能</h1><p>具体代码的编写请跟着石头哥的视频走</p>
<h2 id="11-1，注册页"><a href="#11-1，注册页" class="headerlink" title="11-1，	注册页"></a>11-1，	注册页</h2><p>注册页主要用到了input组件获取用户输入，button组件实现注册功能，注册主要是把账号名和密码添加到云开发数据库</p>
<h2 id="11-2，登陆页"><a href="#11-2，登陆页" class="headerlink" title="11-2，	登陆页"></a>11-2，	登陆页</h2><p>登陆主要是获取用户输入的账号和密码，然后从数据库里读取相应的数据，做账号和密码的比对，如果账号和密码都一样，就可以直接登陆成功</p>
<h2 id="11-3，登陆成功跳转到首页"><a href="#11-3，登陆成功跳转到首页" class="headerlink" title="11-3，	登陆成功跳转到首页"></a>11-3，	登陆成功跳转到首页</h2><p>登陆成功以后，会调整到首页</p>
<h2 id="11-4，保存登陆状态"><a href="#11-4，保存登陆状态" class="headerlink" title="11-4，	保存登陆状态"></a>11-4，	保存登陆状态</h2><p>我们通常做登陆时，用户登陆成功后我们需要帮用户保存登陆状态，要不然用户下次再进入应用时还要重新登陆。所以我们要做下用户登陆状态的保存</p>
<h1 id="十二，云开发实现点赞收藏评论功能"><a href="#十二，云开发实现点赞收藏评论功能" class="headerlink" title="十二，云开发实现点赞收藏评论功能"></a>十二，云开发实现点赞收藏评论功能</h1><p>具体代码的编写请跟着石头哥的视频走</p>
<h2 id="12-1，常用图标获取网站"><a href="#12-1，常用图标获取网站" class="headerlink" title="12-1，	常用图标获取网站"></a>12-1，	常用图标获取网站</h2><p>这里用了一个阿里巴巴矢量图库：<a target="_blank" rel="noopener" href="https://www.iconfont.cn/">https://www.iconfont.cn</a></p>
<h2 id="12-2，云函数里初始化云开发环境"><a href="#12-2，云函数里初始化云开发环境" class="headerlink" title="12-2，	云函数里初始化云开发环境"></a>12-2，	云函数里初始化云开发环境</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cloud.init(&#123;</span><br><span class="line">env: cloud.DYNAMIC_CURRENT_ENV</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="十三，评论功能的简单实现"><a href="#十三，评论功能的简单实现" class="headerlink" title="十三，评论功能的简单实现"></a>十三，评论功能的简单实现</h1><p>具体代码的编写请跟着石头哥的视频走，这一节不在准备笔记</p>
<h1 id="十四，CMS网页版管理后台"><a href="#十四，CMS网页版管理后台" class="headerlink" title="十四，CMS网页版管理后台"></a>十四，CMS网页版管理后台</h1><h2 id="14-1，开通cms的准备工作"><a href="#14-1，开通cms的准备工作" class="headerlink" title="14-1，开通cms的准备工作"></a>14-1，开通cms的准备工作</h2><p>如下图所示，直接点击开通内容管理(CMS)即可<br><img src="https://img-blog.csdnimg.cn/20210210113912477.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>开通cms需要你云开发里使用按量付费，如果你是第一次开通云开发，记得做如下选择。<br><img src="https://img-blog.csdnimg.cn/20210310190751658.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>如果你已经开通过云开发，记得把付费模式改为按量付费。如果你一开始云开发不是按量付费的模式。</p>
<p>点击完开通以后，会有如下弹窗，直接点击确定即可。不要被付费吓着，官方每月会送我们一定的免费额度的。学习得话基本上够用了。<br><img src="https://img-blog.csdnimg.cn/20210210114114135.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>上面点完确定后，我们只是开启了按量付费功能，因为cms得使用必须要开通按量付费才可以得。所以还要再点一次开通。如下图<br><img src="https://img-blog.csdnimg.cn/20210210114330998.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>点完开通后，会有如下弹窗，直接点击下一步即可。<br><img src="https://img-blog.csdnimg.cn/20210210114443541.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>然后我们需要设置登录内容管理后台得账号和密码，然后点击确定即可<br><img src="https://img-blog.csdnimg.cn/20210210114541730.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>然后我们就等待内容管理功能得开通了，需要等几分钟。<br><img src="https://img-blog.csdnimg.cn/20210210114640668.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>开通成功以后，我们就可以通过下面这个地址进入管理后台了。<br><img src="https://img-blog.csdnimg.cn/20210210133616295.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>后面我们统一称内容管理为cms</p>
<h2 id="14-2，注意事项"><a href="#14-2，注意事项" class="headerlink" title="14-2，注意事项"></a>14-2，注意事项</h2><ul>
<li>一个云开发环境对应一个内容管理(cms)</li>
<li>cms开通会存在开通失败的情况，如果开通失败了，就用新的云开发环境去开通，如果新的云开发环境还是不行的话，那就只能重新去注册一个新的小程序了。一个小程序是可以开通两个云开发环境的。</li>
</ul>
<h2 id="14-3，登录Cms可视化管理后台"><a href="#14-3，登录Cms可视化管理后台" class="headerlink" title="14-3，登录Cms可视化管理后台"></a>14-3，登录Cms可视化管理后台</h2><p>上面开通好以后，就可以通过后台地址登录管理后台了。如下<br><img src="https://img-blog.csdnimg.cn/20210210133522942.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h2 id="14-4，在cms里创建后台项目"><a href="#14-4，在cms里创建后台项目" class="headerlink" title="14-4，在cms里创建后台项目"></a>14-4，在cms里创建后台项目</h2><p>第一次登录，我们还需要创建一个项目<br><img src="https://img-blog.csdnimg.cn/20210210133725671.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>自己输入项目名和项目id即可<br><img src="https://img-blog.csdnimg.cn/20210210133904722.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>然后点击进入刚刚创建的项目<br><img src="https://img-blog.csdnimg.cn/9f7b0fb259104355954fa44c817029c7.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA57yW56iL5bCP55-z5aS0,size_20,color_FFFFFF,t_70,g_se,x_16"></p>
<p>到这里我们的cmd可视化网页管理后台就创建好了</p>
<h2 id="14-5，内容模型"><a href="#14-5，内容模型" class="headerlink" title="14-5，内容模型"></a>14-5，内容模型</h2><p><img src="https://img-blog.csdnimg.cn/8382630149d541af89e4512c57914ce9.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA57yW56iL5bCP55-z5aS0,size_20,color_FFFFFF,t_70,g_se,x_16"><br>我会在视频里教大家如何创建内容模型，其实内容模型和我们数据库里的数据表(集合)是对应起来的。</p>
<h2 id="14-6，数据类型"><a href="#14-6，数据类型" class="headerlink" title="14-6，数据类型"></a>14-6，数据类型</h2><p>我们往内容模型里添加数据类型的时候可以选择如下一些类型<br><img src="https://img-blog.csdnimg.cn/711bfdbb8474433ab0be987afe683f5c.png"><br>我会在视频里把一些常用的数据类型给大家做详细讲解</p>
<h2 id="14-7，数据表-集合-管理"><a href="#14-7，数据表-集合-管理" class="headerlink" title="14-7，数据表(集合)管理"></a>14-7，数据表(集合)管理</h2><p>我们可以对上面创建好的内容模型(集合)进行可视化的管理，这也是cms的优点，可以让我们对数据库进行可视化的管理。<br><img src="https://img-blog.csdnimg.cn/2493b0597b2843929b0b89ece373f445.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA57yW56iL5bCP55-z5aS0,size_20,color_FFFFFF,t_70,g_se,x_16"></p>
<h2 id="14-8，综合案例"><a href="#14-8，综合案例" class="headerlink" title="14-8，综合案例"></a>14-8，综合案例</h2><p>我会结合cms和云开发数据库，教大家实现一个简单的新闻小程序，有如下功能点</p>
<ul>
<li>1，新闻列表</li>
<li>2，新闻详情</li>
<li>3，图文混排</li>
<li>4，富文本编辑</li>
<li>5，rich-text的学习</li>
</ul>
<p>rich-text官方文档：<br><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/component/rich-text.html">https://developers.weixin.qq.com/miniprogram/dev/component/rich-text.html</a></p>
<p>我会在视频里教大家一步步的实现这个综合案例，这个综合案例能跟着石头哥完整的做下来的话，你的小程序云开发的知识点也就学习的差不多了。</p>
<h1 id="云开发实战案例···》"><a href="#云开发实战案例···》" class="headerlink" title="云开发实战案例···》"></a>云开发实战案例···》</h1><h1 id="实战一，云开发实现订阅消息推送"><a href="#实战一，云开发实现订阅消息推送" class="headerlink" title="实战一，云开发实现订阅消息推送"></a>实战一，云开发实现订阅消息推送</h1><blockquote>
<p>之前的通过formid发送模板消息推送，将在2020年1月10日下线，所以我们不得不使用订阅消息了。</p>
</blockquote>
<p>我们先来看下订阅消息的官方简介。<br><img src="https://img-blog.csdnimg.cn/img_convert/b7db371aea0e724e54f6d94c279171ba.png" alt=" "><br>接下来我们就来借助云开发，来快速实现小程序消息推送的功能。</p>
<h2 id="1-获取模板-ID"><a href="#1-获取模板-ID" class="headerlink" title="1,获取模板 ID"></a>1,获取模板 ID</h2><p>这一步和我们之前的模板消息推送是一样的，也是先添加模板，然后拿到模板id<br><img src="https://img-blog.csdnimg.cn/img_convert/3a3cb57812e875bc3b70c3425a5a900a.png" alt=" "><br>首先是开通订阅消息功能，很简单，如下图<br><img src="https://img-blog.csdnimg.cn/img_convert/b271655c0edb6ca4751da3d2c891bde0.png" alt=" "><br>由于长期性订阅消息，目前仅向政务民生、医疗、交通、金融、教育等线下公共服务开放，后期将逐步支持到其他线下公共服务业务。仅就线下公共服务这一点，长期性订阅消息就和大部分开发者无缘了。<br>所以我们这里只能以使用一次性订阅消息为例。<br><img src="https://img-blog.csdnimg.cn/img_convert/421d178fcfee1bfccd5ae0839d76a7c6.png" alt=" "><br>如上图，我们从公共模板库里选择一个一次性订阅的模板。然后编辑模板如下图<br><img src="https://img-blog.csdnimg.cn/img_convert/a0f65d36b5d27fd329c14d2df34cde00.png" alt=" "><br>下图就是我们添加好的模板，下图的模板id就是我们需要的。<br><img src="https://img-blog.csdnimg.cn/img_convert/8bd49bd2ddc542f0c4484aa7db73b6f7.png" alt=" "></p>
<h2 id="2-请求用户授权"><a href="#2-请求用户授权" class="headerlink" title="2,请求用户授权"></a>2,请求用户授权</h2><p>我们做订阅消息授权时，只能是用户点击或者支付完成后才可以调起来授权弹窗，官方是这么要求的：<br><img src="https://img-blog.csdnimg.cn/img_convert/20dca555457350c4c5d959e5d96e6c53.png" alt=" "><br>我们这里用到了wx.requestSubscribeMessage这个方法，来获取用户的授权。</p>
<ul>
<li>1，编写index.wxml代码<br><img src="https://img-blog.csdnimg.cn/img_convert/05dade190a567e04dd9c37315a685697.png" alt=" "></li>
<li>2，编写index.js代码,实现点击获取授权<br><img src="https://img-blog.csdnimg.cn/img_convert/41ce63de1a026e53ab47208cc39f2134.png" alt=" "><br>这一步tmplIds里的一串字符，就是我们自己添加的模板id</li>
<li>3，点击按钮运行效果如下<br>开发者工具模拟器上点击授权弹窗是这样的：<br><img src="https://img-blog.csdnimg.cn/img_convert/7a8f3304b2ff6971069831bb2524cca1.png" alt=" "><br>手机上的授权弹窗是这样的：<br><img src="https://img-blog.csdnimg.cn/img_convert/67407a9080f668313efb41eac09cdc33.png" alt=" "><br>可以看到，这里显示的就是我们添加的 ‘上课提醒’的模板。<br>细心的同学可以看到， 真机上多了一个 ‘总是保持以上选择，不再询问’<br>其实，你自己仔细多品一些。也能明天，我们正常订阅消息授权时，用户允许的话，你只能推送一次消息。也就是用户允许一次，我们就可以推送一条消息给用户，并且这个允许不存在过期。所以我们可以让用户尽量多的点击允许，这样我们就可以尽量多的给用户发送消息了。</li>
</ul>
<p>这里用户允许后，我们就可以给用户推送消息了，接下来我们来借助云开发的云函数来实现消息推送功能。</p>
<h2 id="3-获取用户的opneid"><a href="#3-获取用户的opneid" class="headerlink" title="3,获取用户的opneid"></a>3,获取用户的opneid</h2><p>先来看官方爸爸是怎么说的。<br><img src="https://img-blog.csdnimg.cn/img_convert/482348d3ed75f4073d52a2a19725d022.png" alt=" "><br>可以看出官方提供了两种方式，我们这里使用云调用。说白了就是在云函数里调用推送功能。</p>
<ul>
<li>推送所需参数<br><img src="https://img-blog.csdnimg.cn/img_convert/b618346a4b113511dc583b2a223fc0de.png" alt=" "><br>可以看到我这里用来openapi功能，并且需要用到用户的opneid，关于openid的获取，我之前有写过文章，也录过视频的。文章的话，大家去翻下我历史的文章，视频的话，点击这个即可：<a target="_blank" rel="noopener" href="https://edu.csdn.net/course/play/26572/336253">《借助云函数获取用户openid》</a><br>这里的openid的获取我就不再详细讲解了，把对应云函数的代码给大家贴出来。<br><img src="https://img-blog.csdnimg.cn/img_convert/ea953e4aedb5e5290741cfe9341bc308.png" alt=" "><br>在使用云开发时，有几点需要注意的</li>
<li>1，需要在project.config.json里创建云函数目录如下图<br><img src="https://img-blog.csdnimg.cn/img_convert/c57726436bc359a7f0b451fed2134541.png" alt=" "></li>
<li>2，需要在app.js里初始化云开发环境<br><img src="https://img-blog.csdnimg.cn/img_convert/ffbc71638437f0ac2071d03040533069.png" alt=" "><br>至于云开发的环境id从哪里拿，我视频里也讲过很多遍了，直接去看我视频或者翻看我历史文章即可。<br><a target="_blank" rel="noopener" href="https://edu.csdn.net/course/play/26572/336253">《零基础入门云开发视频》</a></li>
</ul>
<h2 id="4-用云函数实现消息推送"><a href="#4-用云函数实现消息推送" class="headerlink" title="4,用云函数实现消息推送"></a>4,用云函数实现消息推送</h2><p>我们只需要创建一个云函数如下，然后填入用户的openid，要跳转的小程序页面链接，模板内容，模板id即可。通常这些数据都应该传进来，简单起见，我就把这里的模板内容写成固定的。<br><img src="https://img-blog.csdnimg.cn/img_convert/6ea360fbc3e9a0ac1c2e8c984383168b.png" alt=" "></p>
<p><strong>注意</strong>：我在编写上面的代码时，推送内容的key必须和小程序模板里的key保持一致，否则就会报如下错误。</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/7744febaaa1b6995afb5142965868cca.png" alt=" "></p>
<ul>
<li>然后看下调用这个云函数的地方<br><img src="https://img-blog.csdnimg.cn/img_convert/e2f325a86fb00c41f0f2ffe8c9c7f837.png" alt=" "><br>如果用户没有授权，我们推送会报如下错误<br><img src="https://img-blog.csdnimg.cn/img_convert/83e90947b16a013ffcab009e135f4397.png" alt=" "><br>如果用户授权过，我们就可以成功推送了，推送后的打印日志如下<br><img src="https://img-blog.csdnimg.cn/img_convert/fd154f7403927c3ef6ccb24b5ab82c76.png" alt=" "><br>还记得我们真机上的授权吗，如果用户只是点击了允许，没有选择一直允许，那我我们在推送成功一次后，如果再次推送，就需要用户重新授权。否则，还是会报这个错误的<br><img src="https://img-blog.csdnimg.cn/img_convert/7e05bc2ef9423835273e59a435c6ca34.png" alt=" "><br>所以我们用户点击一次允许，我们就可以推送一次消息，比如，我点击了4次允许那么我就可以成功的推送4次<br><img src="https://img-blog.csdnimg.cn/img_convert/48161ca1040adf3b859009c6c65a304a.png" alt=" "></li>
</ul>
<h3 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h3><p><img src="https://img-blog.csdnimg.cn/img_convert/a3110cee08ea827cdd438fb164050d41.png" alt=" "><br>可以看到，我们成功的收到 上课提醒的模板消息，点击进去，就是我们具体的推送内容<br><img src="https://img-blog.csdnimg.cn/img_convert/8661b2bcbcf2f2f688e6b5bf0e30a67d.png" alt=" "><br>其实我这是连续收到了4条消息，因为我点击了4次允许推送，所以就可以成功的推送4次。</p>
<p>到这里我们就完整的实现模板消息推送功能了，下面我把主要代码贴给大家，大家也可以私信我获取完整源码。</p>
<ul>
<li>index.wxml</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;button bindtap=&quot;shouquan&quot; type=&#x27;primary&#x27;&gt;获取订阅消息授权&lt;/button&gt;</span><br><span class="line">&lt;button bindtap=&quot;getOpenid&quot;&gt;获取用户的openid并推送消息&lt;/button&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>index.js</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">//编程小石头wechat：2501902696</span><br><span class="line">Page(&#123;</span><br><span class="line">  //获取授权的点击事件</span><br><span class="line">  shouquan() &#123;</span><br><span class="line">    wx.requestSubscribeMessage(&#123;</span><br><span class="line">      tmplIds: [&#x27;CFeSWarQLMPyPjwmiy6AV4eB-IZcipu48V8bFLkBzTU&#x27;], //这里填入我们生成的模板id</span><br><span class="line">      success(res) &#123;</span><br><span class="line">        console.log(&#x27;授权成功&#x27;, res)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail(res) &#123;</span><br><span class="line">        console.log(&#x27;授权失败&#x27;, res)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  //获取用户的openid</span><br><span class="line">  getOpenid() &#123;</span><br><span class="line">    wx.cloud.callFunction(&#123;</span><br><span class="line">      name: &quot;getopenid&quot;</span><br><span class="line">    &#125;).then(res =&gt; &#123;</span><br><span class="line">      let openid = res.result.openid</span><br><span class="line">      console.log(&quot;获取openid成功&quot;, openid)</span><br><span class="line">      this.send(openid)</span><br><span class="line">    &#125;).catch(res =&gt; &#123;</span><br><span class="line">      console.log(&quot;获取openid失败&quot;, res)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  //发送模板消息到指定用户,推送之前要先获取用户的openid</span><br><span class="line">  send(openid) &#123;</span><br><span class="line">    wx.cloud.callFunction(&#123;</span><br><span class="line">      name: &quot;sendMsg&quot;,</span><br><span class="line">      data: &#123;</span><br><span class="line">        openid: openid</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;).then(res =&gt; &#123;</span><br><span class="line">      console.log(&quot;推送消息成功&quot;, res)</span><br><span class="line">    &#125;).catch(res =&gt; &#123;</span><br><span class="line">      console.log(&quot;推送消息失败&quot;, res)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>推送对应的云函数</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">//编程小石头wechat：2501902696</span><br><span class="line">const cloud = require(&#x27;wx-server-sdk&#x27;)</span><br><span class="line">cloud.init()</span><br><span class="line">exports.main = async(event, context) =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    const result = await cloud.openapi.subscribeMessage.send(&#123;</span><br><span class="line">      touser: event.openid, //要推送给那个用户</span><br><span class="line">      page: &#x27;pages/index/index&#x27;, //要跳转到那个小程序页面</span><br><span class="line">      data: &#123;//推送的内容</span><br><span class="line">        thing1: &#123;</span><br><span class="line">          value: &#x27;小程序入门课程&#x27;</span><br><span class="line">        &#125;,</span><br><span class="line">        thing6: &#123;</span><br><span class="line">          value: &#x27;杭州浙江大学&#x27;</span><br><span class="line">        &#125;,</span><br><span class="line">        thing7: &#123;</span><br><span class="line">          value: &#x27;第一章第一节&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      templateId: &#x27;CFeSWarQLMPyPjwmiy6AV4eB-IZcipu48V8bFLkBzTU&#x27; //模板id</span><br><span class="line">    &#125;)</span><br><span class="line">    console.log(result)</span><br><span class="line">    return result</span><br><span class="line">  &#125; catch (err) &#123;</span><br><span class="line">    console.log(err)</span><br><span class="line">    return err</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>后面我会分享更多小程序相关的知识出来，请持续关注。</p>
<p><strong>注意</strong>：授权一次，只能发送一条消息。</p>
<h2 id="5-发送订阅消息给多个用户"><a href="#5-发送订阅消息给多个用户" class="headerlink" title="5,发送订阅消息给多个用户"></a>5,发送订阅消息给多个用户</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">//发送订阅消息给多个用户</span><br><span class="line">  sendAll() &#123;</span><br><span class="line">    if (name == null || name == &#x27;&#x27;) &#123;</span><br><span class="line">      wx.showToast(&#123;</span><br><span class="line">        icon: &quot;none&quot;,</span><br><span class="line">        title: &#x27;请输入课程名&#x27;,</span><br><span class="line">      &#125;)</span><br><span class="line">      return</span><br><span class="line">    &#125;</span><br><span class="line">    let users = [</span><br><span class="line">      &quot;oc4sa0Vp_s65LEItm4JSWT5WFQds&quot;,</span><br><span class="line">      &quot;oc4sa0dZ-pSCu95djiLCt7jo97bY&quot;</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    users.forEach(item =&gt; &#123;</span><br><span class="line">      console.log(&quot;for循环&quot;, item)</span><br><span class="line">      this.sendFun(item, name)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  //封装的方式方法</span><br><span class="line">  sendFun(openid, name) &#123;</span><br><span class="line">    wx.cloud.callFunction(&#123;</span><br><span class="line">      name: &quot;fasong&quot;,</span><br><span class="line">      data: &#123;</span><br><span class="line">        openid: openid,</span><br><span class="line">        name: name</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;).then(res =&gt; &#123;</span><br><span class="line">      console.log(&quot;发送单条成功&quot;, res)</span><br><span class="line">    &#125;).catch(res =&gt; &#123;</span><br><span class="line">      console.log(&quot;发送单条失败&quot;, res)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h1 id="实战二，短信验证码"><a href="#实战二，短信验证码" class="headerlink" title="实战二，短信验证码"></a>实战二，短信验证码</h1><h3 id="老规矩先看效果图"><a href="#老规矩先看效果图" class="headerlink" title="老规矩先看效果图"></a>老规矩先看效果图</h3><p>普通短信<br><img src="https://img-blog.csdnimg.cn/20210109140541115.png"><br>验证码短信<br><img src="https://img-blog.csdnimg.cn/20210109140513489.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<p>今天被云开发官方告知，云开发支持发短信功能了，然后就迫不及待的来尝下鲜。</p>
<p>官方文档：<br><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/cloudbase/cloudbase.sendSms.html">https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/cloudbase/cloudbase.sendSms.html</a></p>
<p>进入官方文档一看，云开发给咱们开发者的福利还真不小。<br>不仅仅可以很方便的使用短信功能，还送了咱们1000条免费短信。不用白不用嘛。这1000条短信足够咱们把小程序短信功能，和小程序短信验证码功能都学会了。<br>废话不多说了，咱们直接来撸代码</p>
<h2 id="1，使用云开发短信的条件"><a href="#1，使用云开发短信的条件" class="headerlink" title="1，使用云开发短信的条件"></a>1，使用云开发短信的条件</h2><p>这个前置条件很重要，条件不满足，你就没法使用云开发短信功能。</p>
<h4 id="使用条件"><a href="#使用条件" class="headerlink" title="使用条件"></a>使用条件</h4><ul>
<li>1，必须是企业小程序，目前个人小程序无法使用短信发送</li>
<li>2，必须开通静态网站功能（后面应该会逐步放开）</li>
<li>3，必须开通云开发（这个没得说，不开通云开发你还用啥云开发功能啊）</li>
</ul>
<p>上面条件都满足以后，我们就可以来愉快的撸代码了。</p>
<p>年卡福利</p>
<ul>
<li>1，可以获取石头哥目前所有视频课</li>
<li>2，未来一年内出的新课也可以获取</li>
<li>3，一对一问题解答，远程协助</li>
<li>4，可以借用石头哥的企业小程序</li>
</ul>
<p>感兴趣可以加石头哥微♥ 2501902696 备注年卡</p>
<h2 id="2，开通静态网站功能"><a href="#2，开通静态网站功能" class="headerlink" title="2，开通静态网站功能"></a>2，开通静态网站功能</h2><p>如果你不开通静态网站，直接调用短信发送，会报如下错误。<br><img src="https://img-blog.csdnimg.cn/20210109121558880.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>其实官方文档里也有给出这个错误。<br><img src="https://img-blog.csdnimg.cn/20210109121621602.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>那么我们就来开通静态网站功能。开通静态网站功能之前，必须开通云开发，配置好云开发的环境。这些我在云开发入门里讲过很多遍。还不知道的同学可以翻看下我前面的文章或者视频：<a target="_blank" rel="noopener" href="https://edu.csdn.net/course/detail/26572">https://edu.csdn.net/course/detail/26572</a></p>
<p>这里开通云开发我们借助小程序开发者工具来实现快速开通。</p>
<h3 id="2-1，注册小程序"><a href="#2-1，注册小程序" class="headerlink" title="2-1，注册小程序"></a>2-1，注册小程序</h3><p>这里我就不再多说了，只有注册过小程序的appid才可以开通云开发<br><img src="https://img-blog.csdnimg.cn/20201211120049359.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>我们注册好小程序后，就可以拿到appid了，如上图</p>
<h3 id="2-2，创建一个小程序项目"><a href="#2-2，创建一个小程序项目" class="headerlink" title="2-2，创建一个小程序项目"></a>2-2，创建一个小程序项目</h3><p>小程序项目的创建，我这里不再多说，我前面小程序基础课里有讲过很多遍。<a target="_blank" rel="noopener" href="https://edu.csdn.net/course/detail/9531">《小程序基础学习》</a><br><img src="https://img-blog.csdnimg.cn/20201211120155733.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>这里强调一点，就是创建小程序项目时一定要用我们自己的appid不要用测试号。<br><img src="https://img-blog.csdnimg.cn/20201211120215471.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>如果你一开始是用测试appid创建的，也可以通过上图的方式更换成自己的小程序的appid。</p>
<h3 id="2-3，开通云开发"><a href="#2-3，开通云开发" class="headerlink" title="2-3，开通云开发"></a>2-3，开通云开发</h3><p>这里云开发的开通，我就不做过多讲解了，我云开发课程里也讲过很多遍。大家可以去翻看下<br><img src="https://img-blog.csdnimg.cn/20201211120750325.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>只需要点击开发者工具里的云开发按钮，跟着提示一步步操作就可以快速开通云开发。</p>
<h3 id="2-4，开通静态网站功能"><a href="#2-4，开通静态网站功能" class="headerlink" title="2-4，开通静态网站功能"></a>2-4，开通静态网站功能</h3><p><img src="https://img-blog.csdnimg.cn/20201211120905504.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>我们上面云开发开通好以后，就可以在这里快速开通静态网站了。<br><img src="https://img-blog.csdnimg.cn/20201211120927392.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>点击以后，直接点击开通即可<br><img src="https://img-blog.csdnimg.cn/20201211120948749.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>这时候开通有个条件<br><img src="https://img-blog.csdnimg.cn/20201211121007349.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>我们必须按照要求改变自己小程序的付费方式，把我们的付费方式改成按量付费即可。<br><img src="https://img-blog.csdnimg.cn/20201211121058390.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>这里不用担心，这里的按量付费，每月都有免费额度。这些额度我们开发学习基本上够用了<br><img src="https://img-blog.csdnimg.cn/20201211121137132.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br><img src="https://img-blog.csdnimg.cn/20201211121144821.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>这个时候我们的静态网站功能就开通成功了。<br><img src="https://img-blog.csdnimg.cn/20201211121157987.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>开通成功以后如下图。<br><img src="https://img-blog.csdnimg.cn/20201211121233312.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br><img src="https://img-blog.csdnimg.cn/20210109123050201.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h2 id="3，编写发送短信的云函数"><a href="#3，编写发送短信的云函数" class="headerlink" title="3，编写发送短信的云函数"></a>3，编写发送短信的云函数</h2><p>其实上面静态网站功能开通以后，我们不用上传网站资源，就可以直接来使用短信功能了。<br>下面我们就来使用云开发的云函数功能来做短信发送功能。<br>老规矩先看效果图<br><img src="https://img-blog.csdnimg.cn/20210109123445994.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>代码编写也很简单<br><img src="https://img-blog.csdnimg.cn/20210109123624813.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>其实发送短信的代码很简单，就上面这几行。下面就来教大家如何编写这个云函数。</p>
<h3 id="3-1，初始化云开发环境id"><a href="#3-1，初始化云开发环境id" class="headerlink" title="3-1，初始化云开发环境id"></a>3-1，初始化云开发环境id</h3><p>新建一个和pages平级的目录cloud，用于存放云函数<br><img src="https://img-blog.csdnimg.cn/2021010912401458.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>然后在project.config.json里添加cloudfunctionRoot选项。<br><img src="https://img-blog.csdnimg.cn/20210109123846528.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>然后对cloud选择当前环境<br><img src="https://img-blog.csdnimg.cn/20210109130001146.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>在app.js里配置环境变量<br><img src="https://img-blog.csdnimg.cn/20210109130043444.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>这个env环境id需要你去云开发控制台获取<br><img src="https://img-blog.csdnimg.cn/20210109130130467.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="3-2，创建云函数"><a href="#3-2，创建云函数" class="headerlink" title="3-2，创建云函数"></a>3-2，创建云函数</h3><p>右键cloud目录，新建Node.js云函数<br><img src="https://img-blog.csdnimg.cn/20210109130223400.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>然后新建一个云函数，名字你可以自定随便定。我这里用sendSms<br><img src="https://img-blog.csdnimg.cn/20210109130321182.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="3-3，编写云函数"><a href="#3-3，编写云函数" class="headerlink" title="3-3，编写云函数"></a>3-3，编写云函数</h3><p><img src="https://img-blog.csdnimg.cn/20210109130405597.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>我这里把代码贴给大家，记得把env和接收短信的手机号换成你自己的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">const cloud = require(&#x27;wx-server-sdk&#x27;)</span><br><span class="line">cloud.init(&#123;</span><br><span class="line">  env: cloud.DYNAMIC_CURRENT_ENV</span><br><span class="line">&#125;)</span><br><span class="line">exports.main = async (event, context) =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    const result = await cloud.openapi.cloudbase.sendSms(&#123;</span><br><span class="line">      env: &#x27;xiaoshitou-zfl2q&#x27;,</span><br><span class="line">      content: &#x27;编程小石头发布了新的能力&#x27;,</span><br><span class="line">      phoneNumberList: [</span><br><span class="line">        &quot;+8615611823564&quot;</span><br><span class="line">      ]</span><br><span class="line">    &#125;)</span><br><span class="line">    return result</span><br><span class="line">  &#125; catch (err) &#123;</span><br><span class="line">    return err</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4，部署云函数"><a href="#3-4，部署云函数" class="headerlink" title="3-4，部署云函数"></a>3-4，部署云函数</h3><p>上面云函数编写好了，一定要记得部署下云函数。右键sendSms然后点击下面箭头所示的即可。<br><img src="https://img-blog.csdnimg.cn/20210109130811107.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>上传部署成功后，会有下面这样的提示<br><img src="https://img-blog.csdnimg.cn/20210109130925613.png"></p>
<h2 id="4，调用云函数发送短信"><a href="#4，调用云函数发送短信" class="headerlink" title="4，调用云函数发送短信"></a>4，调用云函数发送短信</h2><p>我们上面云函数编写并部署成功以后，就可以来调用这个云函数，发送短信了。</p>
<h3 id="4-1，编写wxml文件"><a href="#4-1，编写wxml文件" class="headerlink" title="4-1，编写wxml文件"></a>4-1，编写wxml文件</h3><p>在wxml文件里写一个button按钮，编写一个bindtap点击事件<br><img src="https://img-blog.csdnimg.cn/20210109131049800.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="4-2，编写js文件"><a href="#4-2，编写js文件" class="headerlink" title="4-2，编写js文件"></a>4-2，编写js文件</h3><p>在js文件里实现上面button的点击事件，然后调用云函数<br><img src="https://img-blog.csdnimg.cn/2021010913122362.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>调用云函数时，一定要记得这里的name必须和你的云函数名一模一样。</p>
<h3 id="4-3，点击发送短信"><a href="#4-3，点击发送短信" class="headerlink" title="4-3，点击发送短信"></a>4-3，点击发送短信</h3><p>点击发送短信<br><img src="https://img-blog.csdnimg.cn/2021010913133224.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>点击发送 短信以后，可以看到日志里打印openapi.cloudbase.sendSms:ok<br>这就代表发送成功了。<br>然后再看下手机，收到下面的短信。<br><img src="https://img-blog.csdnimg.cn/2021010913144735.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>到这里我们的短信发送功能就完整的实现了。<br>其实到这里该实现的功能，就已经实现了。但是我们使用短信场景更多的是用短信发送验证码。所以接下来给大家做一个发送短信验证码的例子出来</p>
<h2 id="5，发送验证码短信"><a href="#5，发送验证码短信" class="headerlink" title="5，发送验证码短信"></a>5，发送验证码短信</h2><p>老规矩，先看效果图<br><img src="https://img-blog.csdnimg.cn/20210109132303482.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>我们只需要获取用户输入的手机号，然后点击获取验证码，最后输入短信里接收到的验证码，进行验证即可。</p>
<h3 id="5-1，编写wxml"><a href="#5-1，编写wxml" class="headerlink" title="5-1，编写wxml"></a>5-1，编写wxml</h3><p>页面比较简单，就两个输入框和两个按钮<br><img src="https://img-blog.csdnimg.cn/20210109135120664.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="5-2，编写js"><a href="#5-2，编写js" class="headerlink" title="5-2，编写js"></a>5-2，编写js</h3><p>js里主要是获取用户输入的手机号，然后发送验证码，发送验证码调用云函数实现短信验证码发送功能。用户输入验证码以后进行校验即可。<br><img src="https://img-blog.csdnimg.cn/20210109135258919.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="5-3，发送短信验证码"><a href="#5-3，发送短信验证码" class="headerlink" title="5-3，发送短信验证码"></a>5-3，发送短信验证码</h3><p>用户输入手机号以后，点击发送，可以看到我们手机上收到了如下短信。</p>
<p><img src="https://img-blog.csdnimg.cn/20210109135027532.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>然后用户输入获取到的验证码，点击验证。<br><img src="https://img-blog.csdnimg.cn/20210109135202916.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>可以看到验证成功，验证成功以后后面的操作就可以自己定了，比如验证成功以后跳转到登录成功页。</p>
<p>到这里我们就实现了验证码发送功能了。</p>
<h3 id="5-4-生成随机验证码的方法"><a href="#5-4-生成随机验证码的方法" class="headerlink" title="5-4,生成随机验证码的方法"></a>5-4,生成随机验证码的方法</h3><p>我这里把生成随机验证码的方法贴给大家。</p>
<h4 id="字母和数字混合"><a href="#字母和数字混合" class="headerlink" title="字母和数字混合"></a>字母和数字混合</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//获取随机验证码，n代表几位</span><br><span class="line">generateMixed(n) &#123;</span><br><span class="line">  let chars = [&#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;, &#x27;6&#x27;, &#x27;7&#x27;, &#x27;8&#x27;, &#x27;9&#x27;, &#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, &#x27;D&#x27;, &#x27;E&#x27;, &#x27;F&#x27;, &#x27;G&#x27;, &#x27;H&#x27;, &#x27;I&#x27;, &#x27;J&#x27;, &#x27;K&#x27;, &#x27;L&#x27;, &#x27;M&#x27;, &#x27;N&#x27;, &#x27;O&#x27;, &#x27;P&#x27;, &#x27;Q&#x27;, &#x27;R&#x27;, &#x27;S&#x27;, &#x27;T&#x27;, &#x27;U&#x27;, &#x27;V&#x27;, &#x27;W&#x27;, &#x27;X&#x27;, &#x27;Y&#x27;, &#x27;Z&#x27;];</span><br><span class="line">  let res = &quot;&quot;;</span><br><span class="line">  for (var i = 0; i &lt; n; i++) &#123;</span><br><span class="line">    var id = Math.ceil(Math.random() * 35);</span><br><span class="line">    res += chars[id];</span><br><span class="line">  &#125;</span><br><span class="line">  return res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="数字混合"><a href="#数字混合" class="headerlink" title="数字混合"></a>数字混合</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//获取随机验证码，n代表几位</span><br><span class="line">generateMixed(n) &#123;</span><br><span class="line">  let chars = [&#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;, &#x27;6&#x27;, &#x27;7&#x27;, &#x27;8&#x27;, &#x27;9&#x27;];</span><br><span class="line">  let res = &quot;&quot;;</span><br><span class="line">  for (var i = 0; i &lt; n; i++) &#123;</span><br><span class="line">    var id = Math.ceil(Math.random() * 9);</span><br><span class="line">    res += chars[id];</span><br><span class="line">  &#125;</span><br><span class="line">  return res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="实战三，群发短信"><a href="#实战三，群发短信" class="headerlink" title="实战三，群发短信"></a>实战三，群发短信</h1><p>我们上面给单个手机发送验证码的功能实现了，接下来就教大家如何群发短信。</p>
<p>老规矩，先看效果图<br><img src="https://img-blog.csdnimg.cn/20210111085236867.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>官方文档：<br><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/cloudbase/cloudbase.sendSms.html">https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/cloudbase/cloudbase.sendSms.html</a></p>
<h4 id="使用云开发短信的条件"><a href="#使用云开发短信的条件" class="headerlink" title="使用云开发短信的条件"></a>使用云开发短信的条件</h4><p>这个前置条件很重要，条件不满足，你就没法使用云开发短信功能。</p>
<ul>
<li>1，必须是企业小程序，目前个人小程序无法使用短信发送</li>
<li>2，必须开通静态网站功能（后面应该会逐步放开）</li>
<li>3，必须开通云开发（这个没得说，不开通云开发你还用啥云开发功能啊）</li>
</ul>
<p>上面条件都满足以后，我们就可以来愉快的撸代码了。</p>
<p>年卡福利</p>
<ul>
<li>1，可以获取石头哥目前所有视频课</li>
<li>2，未来一年内出的新课也可以获取</li>
<li>3，一对一问题解答，远程协助</li>
<li>4，可以借用石头哥的企业小程序</li>
</ul>
<p>感兴趣可以加石头哥微♥ 2501902696 备注年卡</p>
<h2 id="1，编写wxml页面"><a href="#1，编写wxml页面" class="headerlink" title="1，编写wxml页面"></a>1，编写wxml页面</h2><p>简单起见，我这里只定义一个输入手机号的输入框和一个button按钮<br><img src="https://img-blog.csdnimg.cn/20210110214701978.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>对应的代码如下<br><img src="https://img-blog.csdnimg.cn/20210110214556726.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="2，获取用户输入的手机号"><a href="#2，获取用户输入的手机号" class="headerlink" title="2，获取用户输入的手机号"></a>2，获取用户输入的手机号</h2><p>我这里以*来分割手机号，如下图所示。<br><img src="https://img-blog.csdnimg.cn/20210110215200429.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>然后我们定义一个bindinput事件来获取用户输入的内容。<br><img src="https://img-blog.csdnimg.cn/20210110215350402.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>可以看到，我们成功的获取到了用户输入的手机号了。<br><img src="https://img-blog.csdnimg.cn/20210110215721299.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>但是官方文档里已经说明，我们群发短信的时候需要用到的是一组手机号，也就是说需要用数组来存放数据。但是我们这里是一个字符串。那么我们就要分割字符串成数组了。</p>
<h2 id="3，分割字符串成数组"><a href="#3，分割字符串成数组" class="headerlink" title="3，分割字符串成数组"></a>3，分割字符串成数组</h2><p>我们分割字符串用到的是字符串的split()方法<br><img src="https://img-blog.csdnimg.cn/20210110215844128.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>当然触发的时机，应该是在用户点击群发按钮的时候。那么我们就为群发按钮定义bindtap点击事件send<br><img src="https://img-blog.csdnimg.cn/20210110220111787.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>可以看到我们成功的把字符串分割成了数组。<br><img src="https://img-blog.csdnimg.cn/20210110220243381.png"><br>但是我们数组里的手机号前面有个回车键，所以安全起见，我们在分割字符串之前，需要先把这回车键给剔除掉。</p>
<h2 id="4，去除字符串里的回车键"><a href="#4，去除字符串里的回车键" class="headerlink" title="4，去除字符串里的回车键"></a>4，去除字符串里的回车键</h2><p>去除字符串里的回车键语法如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">字符串.replace(/[\r\n]/g, &quot;&quot;)</span><br></pre></td></tr></table></figure>
<p>可以看到我们只需要调用字符串.replace方法即可，后面括号里跟的是回车键对应的正则表达式。这里不需要记住，后面用的时候来我笔记这里复制就行了。<br><img src="https://img-blog.csdnimg.cn/20210110220615764.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>可以看到我们剔除回车键以后，再分割的字符串里就没有回车键了。</p>
<h2 id="5，遍历数组给手机号前面-86"><a href="#5，遍历数组给手机号前面-86" class="headerlink" title="5，遍历数组给手机号前面+86"></a>5，遍历数组给手机号前面+86</h2><p>如果你有仔细阅读官方文档，可以看到我们群发的手机号前面必须以+86开头。并且每次群发的手机号不能超过1000条。<br><img src="https://img-blog.csdnimg.cn/2021011022085622.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>那么我们接下来就要遍历数组，给每个手机号前面都添加‘+86’了。<br>当然了这里有很多种方法来实现这一目的，我这里用一个for循环和一个map方法来分别实现下。<br><img src="https://img-blog.csdnimg.cn/20210110222029946.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>可以看出用map方法更简介一点。但是对于新手来说第二种方法可能不是很好理解。所以这里你用那种方法都可以，不做强制要求。</p>
<h3 id="5-1，通过for循环来实现"><a href="#5-1，通过for循环来实现" class="headerlink" title="5-1，通过for循环来实现"></a>5-1，通过for循环来实现</h3><p><img src="https://img-blog.csdnimg.cn/20210110222243469.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h3 id="5-2，通过map方法来实现"><a href="#5-2，通过map方法来实现" class="headerlink" title="5-2，通过map方法来实现"></a>5-2，通过map方法来实现</h3><p><img src="https://img-blog.csdnimg.cn/20210110221534846.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<h2 id="6，编写群发短信的内容"><a href="#6，编写群发短信的内容" class="headerlink" title="6，编写群发短信的内容"></a>6，编写群发短信的内容</h2><p>那么我们接下来要做的就是实现群发功能了。我们这里要想成功的实现群发，需要两个元素</p>
<ul>
<li>要群发的短信内容</li>
<li>要群发的手机号</li>
</ul>
<p>关于手机号和群发内容都有要求<br><img src="https://img-blog.csdnimg.cn/20210110222505278.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>我们群发手机号这里已经符合要求了，接下来就是群发的内容了。群发内容最长不能超过60个字节，一个汉字通常2~3个字节。也就是说我们短信内容不能超过20个字，所以群发的短信一定要精细。用最少的字来吸引用户。</p>
<p>这里其实就是一个input来获取用户输入的内容就行了。我不再多讲，直接把代码贴出来。<br><img src="https://img-blog.csdnimg.cn/20210110223424454.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>在js里获取用户输入的短信内容<br><img src="https://img-blog.csdnimg.cn/2021011022370271.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>现在完事具备，只欠一个云函数了</p>
<h2 id="7，编写群发短信的云函数"><a href="#7，编写群发短信的云函数" class="headerlink" title="7，编写群发短信的云函数"></a>7，编写群发短信的云函数</h2><p>短信内容和群发的手机号都已经成功拿到了，我们接下来就要来编写群发的云函数了。<br><img src="https://img-blog.csdnimg.cn/20210110224043670.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>云函数其实我们短信验证码那一节基本上一样，区别就是</p>
<ul>
<li>短信验证传入的是：验证码+单个手机号</li>
<li>群发传入的是：短信内容+多个手机号</li>
</ul>
<p>云函数编辑好，记得重新部署下。</p>
<h2 id="8，调用云函数实现群发"><a href="#8，调用云函数实现群发" class="headerlink" title="8，调用云函数实现群发"></a>8，调用云函数实现群发</h2><p>上面云函数编辑好了，也部署好了，接下来就是要调用云函数实现短信群发了。<br><img src="https://img-blog.csdnimg.cn/20210110224541938.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>调用其实很简单。</p>
<h2 id="9，群发演示失败"><a href="#9，群发演示失败" class="headerlink" title="9，群发演示失败"></a>9，群发演示失败</h2><p>接下来我们就要验证自己的劳动成果了。如下，我发这样的内容给两个手机号。为什么是两个呢，我这里是学习，要节省短信条数。官方只送我们1000条。所以要省着点用。</p>
<p>其实群发两个手机号，和群发1000个没区别，只要群发两个成果，那么群发1000个也一样的。<br><img src="https://img-blog.csdnimg.cn/20210110224906123.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>辛辛苦苦编写好了，测试了下，居然报错<br><img src="https://img-blog.csdnimg.cn/20210110230354339.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>什么鬼，代码明明没有错误啊，程序员有时候就是莫名的自信。<br>官方给的发送成果返回字段如下<br><img src="https://img-blog.csdnimg.cn/20210110230510989.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>石头哥发送返回结果如下<br><img src="https://img-blog.csdnimg.cn/20210110230547798.png"><br>百思不得其解啊。不会真是代码写错了吧。。。。<br>还好石头哥比较聪明，翻译了一下报错信息。<br><img src="https://img-blog.csdnimg.cn/2021011023071456.png"><br>发送时间限制，也没看到官方文档有说时间限制啊。后来又去官方文档翻来覆去，终于在一个角落里看到了这句话。<br><img src="https://img-blog.csdnimg.cn/202101102309500.png"><br>原来是石头哥写文章太晚了。。。。<br><img src="https://img-blog.csdnimg.cn/20210110230936888.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>本来想写完文章，直接录讲解视频给大家的，，，，看来只能等第二天8-22:00来续写这篇文章了。。。。</p>
<h2 id="10，群发演示成功"><a href="#10，群发演示成功" class="headerlink" title="10，群发演示成功"></a>10，群发演示成功</h2><p><img src="https://img-blog.csdnimg.cn/20210111084743770.png"></p>
<p>终于等到了第二天8点47，下面我们把昨天的群发短信再演示一遍，看这次能不能成功。<br>先来看我们的日志<br><img src="https://img-blog.csdnimg.cn/20210111084934161.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>可以看出日志上显示成功的发送两个。那么收到的短信长什么样子，也给大家截个图。<br>第一个手机号是安卓手机<br><img src="https://img-blog.csdnimg.cn/20210111085236867.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"></p>
<p>第二个手机号是苹果手机<br><img src="https://img-blog.csdnimg.cn/20210111085303414.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpdXNoaV8xOTkw,size_16,color_FFFFFF,t_70"><br>到这里我们的群发短信功能就完整的实现了。</p>
<h1 id="自己开发时添加的笔记"><a href="#自己开发时添加的笔记" class="headerlink" title="自己开发时添加的笔记"></a><strong>自己开发时添加的笔记</strong></h1><h4 id="1-wx-reLaunch和wx-navigateTo，wx-navigateTo的区别"><a href="#1-wx-reLaunch和wx-navigateTo，wx-navigateTo的区别" class="headerlink" title="1.wx.reLaunch和wx.navigateTo，wx.navigateTo的区别"></a>1.wx.reLaunch和wx.navigateTo，wx.navigateTo的区别</h4><p><strong>wx.navigateTo</strong> 用于保留当前页面、跳转到应用内的某个页面，使用 wx.navigateBack可以返回到原页面。对于页面不是特别多的小程序，通常推荐使用 wx.navigateTo进行跳转， 以便返回原页面，以提高加载速度。当页面特别多时，则不推荐使用。</p>
<p><strong>wx.redirectTo</strong> 当页面过多时，被保留页面会挤占微信分配给小程序的<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%86%85%E5%AD%98&spm=1001.2101.3001.7020">内存</a>，或是达到微信所限制的 5 层页面栈。这时，我们应该考虑选择 wx.redirectTo。wx.redirectTo()用于关闭当前页面，跳转到应用内的某个页面。这样的跳转，可以避免跳转前页面占据运行内存，但返回时页面需要重新加载，增加了返回页面的显示时间。</p>
<p><strong>wx.reLaunch</strong> wx.reLaunch()与 wx.redirectTo()的用途基本相同， 只是 wx.reLaunch()先关闭了内存中所有保留的页面，再跳转到目标页面。</p>
<p><strong>wx.switchTab</strong> 对于跳转到 tab bar 的页面，最好选择 wx.switchTab()，它会先关闭所有非 tab bar 的页面。其次，也可以选择 wx.reLaunch()，它也能实现从非 tab bar 跳转到 tab bar，或在 tab bar 间跳转，效果等同 wx.switchTab()。使用其他跳转 API 来跳转到 tab bar，则会跳转失败。</p>
<p><strong>wx.navigateBack</strong> 用于关闭当前页面，并返回上一页面或多级页面。开发者可通过 getCurrentPages() 获取当前的页面栈，决定需要返回几层。这个 API 需要填写的参数只有 delta，表示要返回的页面数。若 delta 的取值大于现有可返回页面数时，则返回到用户进入小程序的第一个页面。当不填写 delta 的值时，就默认其为 1（注意，默认并非取 0），即返回上一页面。</p>
<h4 id="2-异步问题在js里面执行的时候"><a href="#2-异步问题在js里面执行的时候" class="headerlink" title="2.异步问题在js里面执行的时候"></a>2.异步问题在js里面执行的时候</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//要用到ansyc  和 await 一起使用，进行to</span><br></pre></td></tr></table></figure>

<h4 id="3-获取当前的时间，并且格式化"><a href="#3-获取当前的时间，并且格式化" class="headerlink" title="3.获取当前的时间，并且格式化"></a>3.获取当前的时间，并且格式化</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myDate = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="keyword">var</span> creat_date_time=myDate.<span class="title function_">getFullYear</span>() + <span class="string">&#x27;-&#x27;</span> + (myDate.<span class="title function_">getMonth</span>() + <span class="number">1</span>) + <span class="string">&#x27;-&#x27;</span> + myDate.<span class="title function_">getDate</span>() + <span class="string">&#x27; &#x27;</span> + myDate.<span class="title function_">getHours</span>() + <span class="string">&#x27;:&#x27;</span> + myDate.<span class="title function_">getMinutes</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(creat_date_time)</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Guo·Hugo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://guo631.top/2022/11/22/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BA%91%E5%BC%80%E5%8F%91%E7%94%B5%E5%AD%90%E4%B9%A620220308/">https://guo631.top/2022/11/22/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BA%91%E5%BC%80%E5%8F%91%E7%94%B5%E5%AD%90%E4%B9%A620220308/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://guo631.top" target="_blank">果のBlog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2022/11/24/QEjFXh8iyPLpgZu.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2022/11/22/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E7%AE%A1%E7%90%86%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/"><img class="next-cover" src="https://s2.loli.net/2022/11/24/ju4opOa8iZbPgnD.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">网络工程课堂笔记</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://s2.loli.net/2022/11/23/6HAUPWfn4xk7Ld9.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Guo·Hugo</div><div class="author-info__description">一生所求，爱与自由</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/guo631/guo631.github.io"><i class="fab fa-github"></i><span>进来玩呀</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/guo631/guo631.github.io" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:xxxxxx@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://shang.qq.com" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="https://s2.loli.net/2022/11/24/rGesdnxkqIXaH1T.jpg" target="_blank" title="weichat"><i class="fab fa-weixin"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的小破站，听闻少年应与平庸相斥，与君共勉。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%EF%BC%8C%E8%AE%B2%E8%A7%A3%E8%A7%86%E9%A2%91"><span class="toc-text">1，讲解视频</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%EF%BC%8C%E9%85%8D%E5%A5%97%E7%AC%94%E8%AE%B0"><span class="toc-text">2，配套笔记</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%EF%BC%8C%E6%94%AF%E6%8C%81%E7%9F%B3%E5%A4%B4%E5%93%A5%F0%9F%98%8A"><span class="toc-text">3，支持石头哥😊</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1%EF%BC%8C%E6%BA%90%E7%A0%81%E5%92%8C%E9%85%8D%E5%A5%97%E8%B5%84%E6%BA%90%E8%8E%B7%E5%8F%96"><span class="toc-text">3-1，源码和配套资源获取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2%EF%BC%8C%E7%AC%94%E8%AE%B0%E7%94%B5%E5%AD%90%E4%B9%A6"><span class="toc-text">3-2，笔记电子书</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%EF%BC%8C%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94-%E2%97%8F%E2%80%99%E2%97%A1%E2%80%99%E2%97%8F"><span class="toc-text">4，问题解答(●’◡’●)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%EF%BC%8C%E8%AE%A4%E8%AF%86%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BA%91%E5%BC%80%E5%8F%91"><span class="toc-text">一，认识小程序云开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1%EF%BC%8C%E4%BA%91%E5%BC%80%E5%8F%91%E7%AE%80%E4%BB%8B"><span class="toc-text">1-1，云开发简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2%EF%BC%8C%E4%BA%91%E5%BC%80%E5%8F%91%E5%92%8C%E4%BC%A0%E7%BB%9F%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AF%B9%E6%AF%94"><span class="toc-text">1-2，云开发和传统服务器对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3%EF%BC%8CServerless%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F"><span class="toc-text">1-3，Serverless开发模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-1%EF%BC%8C%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%BC%94%E8%BF%9B"><span class="toc-text">1-3-1，前端开发模式的演进</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-2%EF%BC%8C%E4%BB%80%E4%B9%88%E6%98%AFServerless"><span class="toc-text">1-3-2，什么是Serverless</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-3%EF%BC%8CServerless-%E7%9A%84%E4%B8%BB%E8%A6%81%E7%89%B9%E7%82%B9"><span class="toc-text">1-3-3，Serverless 的主要特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-4%EF%BC%8Cserverless-%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-text">1-3-4，serverless 开发流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-5%EF%BC%8Cserverless%E5%B8%A6%E6%9D%A5%E7%9A%84%E4%BB%B7%E5%80%BC"><span class="toc-text">1-3-5，serverless带来的价值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-6%EF%BC%8C%E5%9F%BA%E4%BA%8E-Serverless-%E7%9A%84%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91"><span class="toc-text">1-3-6，基于 Serverless 的小程序开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-7%EF%BC%8C%E9%80%9A%E7%94%A8-Serverless-%E6%9E%B6%E6%9E%84"><span class="toc-text">1-3-7，通用 Serverless 架构</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%EF%BC%8C%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91%E8%80%85%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="toc-text">二，微信开发者工具的安装与使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1%EF%BC%8C%E5%85%B6%E5%AE%9E%E5%BE%88%E7%AE%80%E5%8D%95%EF%BC%8C%E5%8F%AA%E9%9C%80%E8%A6%81%E8%BF%9B%E5%85%A5%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%AE%98%E7%BD%91%EF%BC%8C%E7%84%B6%E5%90%8E%E7%82%B9%E5%87%BB%E5%B7%A5%E5%85%B7%EF%BC%8C%E5%A6%82%E4%B8%8B%E5%9B%BE%E6%89%80%E7%A4%BA%E3%80%82"><span class="toc-text">2-1，其实很简单，只需要进入小程序官网，然后点击工具，如下图所示。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2%EF%BC%8C%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E5%8C%85%E5%A6%82%E4%B8%8B"><span class="toc-text">2-2，下载安装包如下</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3%EF%BC%8C%E8%BF%9B%E5%85%A5%E5%BC%80%E5%8F%91%E8%80%85%E5%B7%A5%E5%85%B7"><span class="toc-text">2-3，进入开发者工具</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%EF%BC%8C%E6%B3%A8%E5%86%8C%E5%B0%8F%E7%A8%8B%E5%BA%8F"><span class="toc-text">三，注册小程序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E5%AE%9E%E5%AE%98%E6%96%B9%E7%BB%99%E7%9A%84%E6%B3%A8%E5%86%8C%E6%AD%A5%E9%AA%A4%E5%BE%88%E8%AF%A6%E7%BB%86%E4%BA%86"><span class="toc-text">其实官方给的注册步骤很详细了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="toc-text">注意点:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%EF%BC%8C%E4%BA%91%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">四，云开发环境的创建与初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%88%9D%E5%A7%8B%E9%A1%B9%E7%9B%AE"><span class="toc-text">4-1,创建一个初始项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E6%96%B0%E7%89%88%E7%9A%84%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E4%B8%8D%E4%BD%BF%E7%94%A8%E6%A8%A1%E6%9D%BF"><span class="toc-text">最新版的开发工具不使用模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8Eappid"><span class="toc-text">关于appid</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2%EF%BC%8C%E6%B2%A1%E6%9C%89%E2%80%9C%E4%B8%8D%E4%BD%BF%E7%94%A8%E4%BA%91%E6%9C%8D%E5%8A%A1%E2%80%9D%E9%80%89%E5%9E%8B%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-%E9%80%89%E7%9C%8B"><span class="toc-text">4-2，没有“不使用云服务”选型解决方案(选看)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E5%BC%80%E9%80%9A%E4%BA%91%E5%BC%80%E5%8F%91"><span class="toc-text">4-3,开通云开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BA%91%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83-%E9%87%8D%E8%A6%81"><span class="toc-text">4-4,初始化云开发环境(***重要)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%EF%BC%8C%E4%BA%91%E5%BC%80%E5%8F%91-%E4%BA%91%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">五，云开发~云数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1%EF%BC%8C%E5%9C%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E9%87%8C%E6%96%B0%E5%BB%BA%E9%9B%86%E5%90%88-%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="toc-text">5-1，在数据库里新建集合(数据表)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2%EF%BC%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-text">5-2，数据库权限管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3%EF%BC%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="toc-text">5-3，数据库的增删改查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-1%EF%BC%8C%E6%9F%A5%E8%AF%A2-get"><span class="toc-text">5-3-1，查询 get()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-2%EF%BC%8C%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2-where"><span class="toc-text">5-3-2，条件查询 where()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-3%EF%BC%8C%E6%9F%A5%E8%AF%A2%E5%8D%95%E6%9D%A1%E6%95%B0%E6%8D%AEdoc"><span class="toc-text">5-3-3，查询单条数据doc()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-4%EF%BC%8C%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE-add"><span class="toc-text">5-3-4，添加数据 add()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-5%EF%BC%8C%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AEupdate"><span class="toc-text">5-3-5，更新数据update()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-6%EF%BC%8C%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AEremove"><span class="toc-text">5-3-6，删除数据remove()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4%EF%BC%8C%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B"><span class="toc-text">5-4，增删改查综合案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-1-%E5%88%97%E8%A1%A8%E8%B7%B3%E8%AF%A6%E6%83%85-data"><span class="toc-text">5-4-1 列表跳详情 data-</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-2%EF%BC%8C%E5%88%97%E8%A1%A8%E8%B7%B3%E8%AF%A6%E6%83%85%E5%B9%B6%E6%90%BA%E5%B8%A6%E5%95%86%E5%93%81id"><span class="toc-text">5-4-2，列表跳详情并携带商品id</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-3%EF%BC%8C%E6%9F%A5%E8%AF%A2%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8"><span class="toc-text">5-4-3，查询商品列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-4%EF%BC%8C%E6%B7%BB%E5%8A%A0%E5%95%86%E5%93%81%E5%B9%B6%E5%88%B7%E6%96%B0%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8"><span class="toc-text">5-4-4，添加商品并刷新商品列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-5%EF%BC%8C%E6%9B%B4%E6%96%B0%E5%95%86%E5%93%81%E6%95%B0%E6%8D%AE"><span class="toc-text">5-4-5，更新商品数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-6%EF%BC%8C%E5%BC%B9%E7%AA%97%E6%8F%90%E7%A4%BA%E7%A1%AE%E8%AE%A4%E6%98%AF%E5%90%A6%E5%88%A0%E9%99%A4"><span class="toc-text">5-4-6，弹窗提示确认是否删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-7%EF%BC%8C%E5%88%A0%E9%99%A4%E5%95%86%E5%93%81"><span class="toc-text">5-4-7，删除商品</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-8%EF%BC%8C%E6%9B%B4%E6%96%B0%E5%92%8C%E5%88%A0%E9%99%A4%E6%97%B6%E7%9A%84%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98"><span class="toc-text">5-4-8，更新和删除时的权限问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-6%EF%BC%8C%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE"><span class="toc-text">5-6，常用快捷键</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-7%EF%BC%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8E%92%E5%BA%8ForderBy"><span class="toc-text">5-7，数据库排序orderBy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-8%EF%BC%8C%E8%BF%94%E5%9B%9E%E6%8C%87%E5%AE%9A%E6%9D%A1%E6%95%B0%E7%9A%84%E6%95%B0%E6%8D%AElimit"><span class="toc-text">5-8，返回指定条数的数据limit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-9%EF%BC%8C%E5%88%86%E9%A1%B5%E6%96%B9%E6%B3%95skip"><span class="toc-text">5-9，分页方法skip</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-10%EF%BC%8CCommand%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-text">5-10，Command数据库操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-10-1%EF%BC%8Cgt%E6%9F%A5%E8%AF%A2%E5%A4%A7%E4%BA%8E%E6%8C%87%E5%AE%9A%E5%80%BC%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-text">5-10-1，gt查询大于指定值的数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-10-2%EF%BC%8Cgte%E6%9F%A5%E8%AF%A2%E5%A4%A7%E4%BA%8E%E7%AD%89%E4%BA%8E%E6%8C%87%E5%AE%9A%E5%80%BC%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-text">5-10-2，gte查询大于等于指定值的数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-10-3%EF%BC%8Clt%E6%9F%A5%E8%AF%A2%E5%B0%8F%E4%BA%8E%E6%8C%87%E5%AE%9A%E6%95%B0%E5%80%BC%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-text">5-10-3，lt查询小于指定数值的数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-10-4%EF%BC%8Clte%E6%9F%A5%E8%AF%A2%E5%B0%8F%E4%BA%8E%E7%AD%89%E4%BA%8E%E6%8C%87%E5%AE%9A%E6%95%B0%E5%80%BC%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-text">5-10-4，lte查询小于等于指定数值的数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-10-5%EF%BC%8Cand%E5%90%8C%E6%97%B6%E6%BB%A1%E8%B6%B3%E5%A4%9A%E4%B8%AA%E6%9D%A1%E4%BB%B6%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="toc-text">5-10-5，and同时满足多个条件的查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%EF%BC%8C%E4%BA%91%E5%BC%80%E5%8F%91-%E4%BA%91%E5%87%BD%E6%95%B0"><span class="toc-text">六，云开发~云函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1%EF%BC%8C%E8%AE%A4%E8%AF%86%E4%BA%91%E5%87%BD%E6%95%B0"><span class="toc-text">6-1，认识云函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-1%EF%BC%8C%E4%BA%91%E5%87%BD%E6%95%B0%E8%8E%B7%E5%8F%96openid"><span class="toc-text">6-1-1，云函数获取openid</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2%EF%BC%8C%E4%BA%91%E5%87%BD%E6%95%B0%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="toc-text">6-2，云函数的优势</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3%EF%BC%8C%E4%BA%91%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E6%BC%94%E7%A4%BA"><span class="toc-text">6-3，云函数调用演示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-0-%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BA%91%E5%87%BD%E6%95%B0%E7%9A%84%E7%8E%AF%E5%A2%83"><span class="toc-text">6-3-0,初始化云函数的环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-1%EF%BC%8C%E4%BA%91%E5%87%BD%E6%95%B0%E8%8E%B7%E5%8F%96openid"><span class="toc-text">6-3-1，云函数获取openid</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-2%EF%BC%8C%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AF%BC%E5%85%A5%E5%92%8C%E5%AF%BC%E5%87%BA"><span class="toc-text">6-3-2，数据的导入和导出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-3%EF%BC%8C%E4%BA%91%E5%87%BD%E6%95%B0%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-text">6-3-3，云函数获取数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-4%EF%BC%8C%E4%BA%91%E5%87%BD%E6%95%B0%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE"><span class="toc-text">6-3-4，云函数修改数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-5%EF%BC%8C%E4%BA%91%E5%87%BD%E6%95%B0%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-text">6-3-5，云函数删除数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-6%EF%BC%8C%E6%8F%90%E4%BA%A4%E6%95%B0%E6%8D%AE%E5%88%B0%E4%BA%91%E5%87%BD%E6%95%B0"><span class="toc-text">6-3-6，提交数据到云函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4-%E4%BD%BF%E7%94%A8%E4%BA%91%E5%87%BD%E6%95%B0%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="toc-text">6-4,使用云函数常见问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-1%EF%BC%8C%E4%BA%91%E5%87%BD%E6%95%B0%E9%87%8C%E9%9D%A2%E6%B2%A1%E6%9C%89%E5%88%9D%E5%A7%8B%E5%8C%96%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-text">6-4-1，云函数里面没有初始化环境变量</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%EF%BC%8C%E4%BA%91%E5%BC%80%E5%8F%91-%E4%BA%91%E5%AD%98%E5%82%A8"><span class="toc-text">七，云开发~云存储</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1%EF%BC%8C%E4%BA%91%E5%BC%80%E5%8F%91%E6%8E%A7%E5%88%B6%E5%8F%B0%E7%AE%A1%E7%90%86%E6%96%87%E4%BB%B6"><span class="toc-text">7-1，云开发控制台管理文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2%EF%BC%8C%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E5%88%B0%E4%BA%91%E5%AD%98%E5%82%A8"><span class="toc-text">7-2，上传图片到云存储</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3%EF%BC%8C%E7%BB%99%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8%E5%8A%A0%E5%95%86%E5%93%81%E5%9B%BE%E7%89%87"><span class="toc-text">7-3，给商品列表加商品图片</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4%EF%BC%8C%E4%B8%8A%E4%BC%A0%E8%A7%86%E9%A2%91%E5%88%B0%E4%BA%91%E5%AD%98%E5%82%A8"><span class="toc-text">7-4，上传视频到云存储</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-5%EF%BC%8C%E4%B8%8A%E4%BC%A0word%EF%BC%8Cexcel%E6%96%87%E4%BB%B6%E5%88%B0%E4%BA%91%E5%AD%98%E5%82%A8"><span class="toc-text">7-5，上传word，excel文件到云存储</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-1%EF%BC%8C%E4%B8%8A%E4%BC%A0%E4%B9%8B%E5%89%8D%E5%85%88%E9%80%89%E6%8B%A9%E6%96%87%E4%BB%B6"><span class="toc-text">7-5-1，上传之前先选择文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-2%EF%BC%8C%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6"><span class="toc-text">7-5-2，上传文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-6%EF%BC%8C%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6"><span class="toc-text">7-6，下载文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-7%EF%BC%8C%E4%B8%8B%E8%BD%BD%E5%B9%B6%E6%89%93%E5%BC%80word%EF%BC%8Cexcel%EF%BC%8Cpdf"><span class="toc-text">7-7，下载并打开word，excel，pdf</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB%EF%BC%8C%E5%88%97%E8%A1%A8%E7%9A%84%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0"><span class="toc-text">八，列表的下拉刷新</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1%EF%BC%8C%E5%BC%80%E5%90%AF%E9%A1%B5%E9%9D%A2%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0"><span class="toc-text">8-1，开启页面下拉刷新</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2%EF%BC%8C%E5%9C%A8Page%E7%9A%84onPullDownRefresh%E9%87%8C%E7%9B%91%E5%90%AC%E5%88%B7%E6%96%B0"><span class="toc-text">8-2，在Page的onPullDownRefresh里监听刷新</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3%EF%BC%8C%E7%94%A8%E6%88%B7%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0%E6%97%B6%E8%AF%B7%E6%B1%82%E6%9C%80%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="toc-text">8-3，用户下拉刷新时请求最新数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4%EF%BC%8C%E6%95%B0%E6%8D%AE%E8%AF%B7%E6%B1%82%E6%88%90%E5%8A%9F%E5%90%8E%E5%81%9C%E6%AD%A2%E5%88%B7%E6%96%B0"><span class="toc-text">8-4，数据请求成功后停止刷新</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B9%9D%EF%BC%8C%E5%88%97%E8%A1%A8%E7%9A%84%E5%88%86%E9%A1%B5%E5%8A%A0%E8%BD%BD"><span class="toc-text">九，列表的分页加载</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1%EF%BC%8C%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E6%AF%8F%E6%AC%A1%E6%9C%80%E5%A4%9A20%E6%9D%A1"><span class="toc-text">9-1，小程序数据库每次最多20条</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2%EF%BC%8C%E5%88%86%E9%A1%B5%E5%8A%A0%E8%BD%BD%E7%9A%84%E6%A0%B8%E5%BF%83%E6%96%B9%E6%B3%95"><span class="toc-text">9-2，分页加载的核心方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-3%EF%BC%8C%E5%AF%BC%E5%85%A5108%E6%9D%A1%E6%95%B0%E6%8D%AE"><span class="toc-text">9-3，导入108条数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-1%EF%BC%8C%E4%B8%8B%E8%BD%BD%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-text">9-3-1，下载数据源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-2%EF%BC%8C%E5%AF%BC%E5%85%A5%E5%88%B0%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="toc-text">9-3-2，导入到数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-3%EF%BC%8C%E5%88%AB%E5%BF%98%E8%AE%B0%E4%BF%AE%E6%94%B9%E8%A1%A8%E6%9D%83%E9%99%90"><span class="toc-text">9-3-3，别忘记修改表权限</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-4%EF%BC%8C%E4%B8%8A%E6%8B%89%E5%8A%A0%E8%BD%BD%E6%9B%B4%E5%A4%9A%E7%9B%91%E5%90%AC"><span class="toc-text">9-4，上拉加载更多监听</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-5%EF%BC%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E9%A1%B5%E5%8A%A0%E8%BD%BD%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">9-5，数据库分页加载代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-5-1%EF%BC%8C%E6%B2%A1%E6%9C%89%E6%9B%B4%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%97%B6%E7%9A%84%E5%8F%8B%E5%A5%BD%E6%8F%90%E7%A4%BA"><span class="toc-text">9-5-1，没有更多数据时的友好提示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-5-2%EF%BC%8C%E5%8A%A0%E8%BD%BD%E4%B8%AD%E5%92%8C%E5%8A%A0%E8%BD%BD%E5%AE%8C%E6%88%90%E7%9A%84%E5%8F%8B%E5%A5%BD%E6%8F%90%E7%A4%BA"><span class="toc-text">9-5-2，加载中和加载完成的友好提示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-6-%E9%80%9A%E8%BF%87%E4%BA%91%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0%E5%88%86%E9%A1%B5%E5%8A%A0%E8%BD%BD"><span class="toc-text">9-6,通过云函数实现分页加载</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%EF%BC%8C%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD"><span class="toc-text">十，搜索功能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1%EF%BC%8C%E9%9C%80%E6%B1%82"><span class="toc-text">10-1，需求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-text">10-2，实现原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-3%EF%BC%8C%E6%A8%A1%E7%B3%8A%E6%90%9C%E7%B4%A2%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">10-3，模糊搜索的代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-1%EF%BC%8C%E6%A8%A1%E7%B3%8A%E6%90%9C%E7%B4%A2%E5%8D%95%E4%B8%AA%E5%AD%97%E6%AE%B5"><span class="toc-text">10-3-1，模糊搜索单个字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-2%EF%BC%8C%E6%A8%A1%E7%B3%8A%E6%90%9C%E7%B4%A2%E5%A4%9A%E4%B8%AA%E5%AD%97%E6%AE%B5%EF%BC%88%E6%BB%A1%E8%B6%B3%E4%B8%80%E4%B8%AA%E5%8D%B3%E5%8F%AF%EF%BC%89"><span class="toc-text">10-3-2，模糊搜索多个字段（满足一个即可）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-3%EF%BC%8C%E6%A8%A1%E7%B3%8A%E6%90%9C%E7%B4%A2%E5%A4%9A%E4%B8%AA%E5%AD%97%E6%AE%B5%EF%BC%88%E8%A6%81%E5%90%8C%E6%97%B6%E6%BB%A1%E8%B6%B3%EF%BC%89"><span class="toc-text">10-3-3，模糊搜索多个字段（要同时满足）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-4%EF%BC%8C%E6%BA%90%E7%A0%81"><span class="toc-text">10-4，源码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-5%EF%BC%8C%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E7%9A%84%E6%90%9C%E7%B4%A2%E8%AF%8D%E6%98%BE%E7%A4%BA%E6%90%9C%E7%B4%A2%E5%88%97%E8%A1%A8"><span class="toc-text">10-5，获取用户输入的搜索词显示搜索列表</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%EF%BC%8C%E4%BA%91%E5%BC%80%E5%8F%91%E5%AE%9E%E7%8E%B0%E7%99%BB%E9%99%86%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%83%BD"><span class="toc-text">十一，云开发实现登陆注册功能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11-1%EF%BC%8C%E6%B3%A8%E5%86%8C%E9%A1%B5"><span class="toc-text">11-1，	注册页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-2%EF%BC%8C%E7%99%BB%E9%99%86%E9%A1%B5"><span class="toc-text">11-2，	登陆页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-3%EF%BC%8C%E7%99%BB%E9%99%86%E6%88%90%E5%8A%9F%E8%B7%B3%E8%BD%AC%E5%88%B0%E9%A6%96%E9%A1%B5"><span class="toc-text">11-3，	登陆成功跳转到首页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-4%EF%BC%8C%E4%BF%9D%E5%AD%98%E7%99%BB%E9%99%86%E7%8A%B6%E6%80%81"><span class="toc-text">11-4，	保存登陆状态</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%EF%BC%8C%E4%BA%91%E5%BC%80%E5%8F%91%E5%AE%9E%E7%8E%B0%E7%82%B9%E8%B5%9E%E6%94%B6%E8%97%8F%E8%AF%84%E8%AE%BA%E5%8A%9F%E8%83%BD"><span class="toc-text">十二，云开发实现点赞收藏评论功能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#12-1%EF%BC%8C%E5%B8%B8%E7%94%A8%E5%9B%BE%E6%A0%87%E8%8E%B7%E5%8F%96%E7%BD%91%E7%AB%99"><span class="toc-text">12-1，	常用图标获取网站</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-2%EF%BC%8C%E4%BA%91%E5%87%BD%E6%95%B0%E9%87%8C%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BA%91%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="toc-text">12-2，	云函数里初始化云开发环境</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%B8%89%EF%BC%8C%E8%AF%84%E8%AE%BA%E5%8A%9F%E8%83%BD%E7%9A%84%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0"><span class="toc-text">十三，评论功能的简单实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E5%9B%9B%EF%BC%8CCMS%E7%BD%91%E9%A1%B5%E7%89%88%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0"><span class="toc-text">十四，CMS网页版管理后台</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#14-1%EF%BC%8C%E5%BC%80%E9%80%9Acms%E7%9A%84%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-text">14-1，开通cms的准备工作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-2%EF%BC%8C%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-text">14-2，注意事项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-3%EF%BC%8C%E7%99%BB%E5%BD%95Cms%E5%8F%AF%E8%A7%86%E5%8C%96%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0"><span class="toc-text">14-3，登录Cms可视化管理后台</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-4%EF%BC%8C%E5%9C%A8cms%E9%87%8C%E5%88%9B%E5%BB%BA%E5%90%8E%E5%8F%B0%E9%A1%B9%E7%9B%AE"><span class="toc-text">14-4，在cms里创建后台项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-5%EF%BC%8C%E5%86%85%E5%AE%B9%E6%A8%A1%E5%9E%8B"><span class="toc-text">14-5，内容模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-6%EF%BC%8C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text">14-6，数据类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-7%EF%BC%8C%E6%95%B0%E6%8D%AE%E8%A1%A8-%E9%9B%86%E5%90%88-%E7%AE%A1%E7%90%86"><span class="toc-text">14-7，数据表(集合)管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-8%EF%BC%8C%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B"><span class="toc-text">14-8，综合案例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%C2%B7%C2%B7%C2%B7%E3%80%8B"><span class="toc-text">云开发实战案例···》</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E4%B8%80%EF%BC%8C%E4%BA%91%E5%BC%80%E5%8F%91%E5%AE%9E%E7%8E%B0%E8%AE%A2%E9%98%85%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81"><span class="toc-text">实战一，云开发实现订阅消息推送</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%8E%B7%E5%8F%96%E6%A8%A1%E6%9D%BF-ID"><span class="toc-text">1,获取模板 ID</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%AF%B7%E6%B1%82%E7%94%A8%E6%88%B7%E6%8E%88%E6%9D%83"><span class="toc-text">2,请求用户授权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E7%9A%84opneid"><span class="toc-text">3,获取用户的opneid</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E7%94%A8%E4%BA%91%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81"><span class="toc-text">4,用云函数实现消息推送</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%88%E6%9E%9C%E5%9B%BE"><span class="toc-text">效果图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%8F%91%E9%80%81%E8%AE%A2%E9%98%85%E6%B6%88%E6%81%AF%E7%BB%99%E5%A4%9A%E4%B8%AA%E7%94%A8%E6%88%B7"><span class="toc-text">5,发送订阅消息给多个用户</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E4%BA%8C%EF%BC%8C%E7%9F%AD%E4%BF%A1%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-text">实战二，短信验证码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%80%81%E8%A7%84%E7%9F%A9%E5%85%88%E7%9C%8B%E6%95%88%E6%9E%9C%E5%9B%BE"><span class="toc-text">老规矩先看效果图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1%EF%BC%8C%E4%BD%BF%E7%94%A8%E4%BA%91%E5%BC%80%E5%8F%91%E7%9F%AD%E4%BF%A1%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="toc-text">1，使用云开发短信的条件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9D%A1%E4%BB%B6"><span class="toc-text">使用条件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%EF%BC%8C%E5%BC%80%E9%80%9A%E9%9D%99%E6%80%81%E7%BD%91%E7%AB%99%E5%8A%9F%E8%83%BD"><span class="toc-text">2，开通静态网站功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%EF%BC%8C%E6%B3%A8%E5%86%8C%E5%B0%8F%E7%A8%8B%E5%BA%8F"><span class="toc-text">2-1，注册小程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%EF%BC%8C%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%A1%B9%E7%9B%AE"><span class="toc-text">2-2，创建一个小程序项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3%EF%BC%8C%E5%BC%80%E9%80%9A%E4%BA%91%E5%BC%80%E5%8F%91"><span class="toc-text">2-3，开通云开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4%EF%BC%8C%E5%BC%80%E9%80%9A%E9%9D%99%E6%80%81%E7%BD%91%E7%AB%99%E5%8A%9F%E8%83%BD"><span class="toc-text">2-4，开通静态网站功能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%EF%BC%8C%E7%BC%96%E5%86%99%E5%8F%91%E9%80%81%E7%9F%AD%E4%BF%A1%E7%9A%84%E4%BA%91%E5%87%BD%E6%95%B0"><span class="toc-text">3，编写发送短信的云函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1%EF%BC%8C%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BA%91%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83id"><span class="toc-text">3-1，初始化云开发环境id</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2%EF%BC%8C%E5%88%9B%E5%BB%BA%E4%BA%91%E5%87%BD%E6%95%B0"><span class="toc-text">3-2，创建云函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3%EF%BC%8C%E7%BC%96%E5%86%99%E4%BA%91%E5%87%BD%E6%95%B0"><span class="toc-text">3-3，编写云函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4%EF%BC%8C%E9%83%A8%E7%BD%B2%E4%BA%91%E5%87%BD%E6%95%B0"><span class="toc-text">3-4，部署云函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%EF%BC%8C%E8%B0%83%E7%94%A8%E4%BA%91%E5%87%BD%E6%95%B0%E5%8F%91%E9%80%81%E7%9F%AD%E4%BF%A1"><span class="toc-text">4，调用云函数发送短信</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1%EF%BC%8C%E7%BC%96%E5%86%99wxml%E6%96%87%E4%BB%B6"><span class="toc-text">4-1，编写wxml文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2%EF%BC%8C%E7%BC%96%E5%86%99js%E6%96%87%E4%BB%B6"><span class="toc-text">4-2，编写js文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3%EF%BC%8C%E7%82%B9%E5%87%BB%E5%8F%91%E9%80%81%E7%9F%AD%E4%BF%A1"><span class="toc-text">4-3，点击发送短信</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%EF%BC%8C%E5%8F%91%E9%80%81%E9%AA%8C%E8%AF%81%E7%A0%81%E7%9F%AD%E4%BF%A1"><span class="toc-text">5，发送验证码短信</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1%EF%BC%8C%E7%BC%96%E5%86%99wxml"><span class="toc-text">5-1，编写wxml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2%EF%BC%8C%E7%BC%96%E5%86%99js"><span class="toc-text">5-2，编写js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3%EF%BC%8C%E5%8F%91%E9%80%81%E7%9F%AD%E4%BF%A1%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-text">5-3，发送短信验证码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E9%AA%8C%E8%AF%81%E7%A0%81%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-text">5-4,生成随机验证码的方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E6%AF%8D%E5%92%8C%E6%95%B0%E5%AD%97%E6%B7%B7%E5%90%88"><span class="toc-text">字母和数字混合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%AD%97%E6%B7%B7%E5%90%88"><span class="toc-text">数字混合</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E4%B8%89%EF%BC%8C%E7%BE%A4%E5%8F%91%E7%9F%AD%E4%BF%A1"><span class="toc-text">实战三，群发短信</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%BA%91%E5%BC%80%E5%8F%91%E7%9F%AD%E4%BF%A1%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="toc-text">使用云开发短信的条件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1%EF%BC%8C%E7%BC%96%E5%86%99wxml%E9%A1%B5%E9%9D%A2"><span class="toc-text">1，编写wxml页面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%EF%BC%8C%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E7%9A%84%E6%89%8B%E6%9C%BA%E5%8F%B7"><span class="toc-text">2，获取用户输入的手机号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%EF%BC%8C%E5%88%86%E5%89%B2%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%88%90%E6%95%B0%E7%BB%84"><span class="toc-text">3，分割字符串成数组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%EF%BC%8C%E5%8E%BB%E9%99%A4%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%87%8C%E7%9A%84%E5%9B%9E%E8%BD%A6%E9%94%AE"><span class="toc-text">4，去除字符串里的回车键</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%EF%BC%8C%E9%81%8D%E5%8E%86%E6%95%B0%E7%BB%84%E7%BB%99%E6%89%8B%E6%9C%BA%E5%8F%B7%E5%89%8D%E9%9D%A2-86"><span class="toc-text">5，遍历数组给手机号前面+86</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1%EF%BC%8C%E9%80%9A%E8%BF%87for%E5%BE%AA%E7%8E%AF%E6%9D%A5%E5%AE%9E%E7%8E%B0"><span class="toc-text">5-1，通过for循环来实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2%EF%BC%8C%E9%80%9A%E8%BF%87map%E6%96%B9%E6%B3%95%E6%9D%A5%E5%AE%9E%E7%8E%B0"><span class="toc-text">5-2，通过map方法来实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%EF%BC%8C%E7%BC%96%E5%86%99%E7%BE%A4%E5%8F%91%E7%9F%AD%E4%BF%A1%E7%9A%84%E5%86%85%E5%AE%B9"><span class="toc-text">6，编写群发短信的内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%EF%BC%8C%E7%BC%96%E5%86%99%E7%BE%A4%E5%8F%91%E7%9F%AD%E4%BF%A1%E7%9A%84%E4%BA%91%E5%87%BD%E6%95%B0"><span class="toc-text">7，编写群发短信的云函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%EF%BC%8C%E8%B0%83%E7%94%A8%E4%BA%91%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0%E7%BE%A4%E5%8F%91"><span class="toc-text">8，调用云函数实现群发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%EF%BC%8C%E7%BE%A4%E5%8F%91%E6%BC%94%E7%A4%BA%E5%A4%B1%E8%B4%A5"><span class="toc-text">9，群发演示失败</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%EF%BC%8C%E7%BE%A4%E5%8F%91%E6%BC%94%E7%A4%BA%E6%88%90%E5%8A%9F"><span class="toc-text">10，群发演示成功</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AA%E5%B7%B1%E5%BC%80%E5%8F%91%E6%97%B6%E6%B7%BB%E5%8A%A0%E7%9A%84%E7%AC%94%E8%AE%B0"><span class="toc-text">自己开发时添加的笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-wx-reLaunch%E5%92%8Cwx-navigateTo%EF%BC%8Cwx-navigateTo%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">1.wx.reLaunch和wx.navigateTo，wx.navigateTo的区别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%BC%82%E6%AD%A5%E9%97%AE%E9%A2%98%E5%9C%A8js%E9%87%8C%E9%9D%A2%E6%89%A7%E8%A1%8C%E7%9A%84%E6%97%B6%E5%80%99"><span class="toc-text">2.异步问题在js里面执行的时候</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%9A%84%E6%97%B6%E9%97%B4%EF%BC%8C%E5%B9%B6%E4%B8%94%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-text">3.获取当前的时间，并且格式化</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/11/22/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BA%91%E5%BC%80%E5%8F%91%E7%94%B5%E5%AD%90%E4%B9%A620220308/" title="微信小程序云开发"><img src="https://s2.loli.net/2022/11/24/QEjFXh8iyPLpgZu.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="微信小程序云开发"/></a><div class="content"><a class="title" href="/2022/11/22/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BA%91%E5%BC%80%E5%8F%91%E7%94%B5%E5%AD%90%E4%B9%A620220308/" title="微信小程序云开发">微信小程序云开发</a><time datetime="2022-11-22T15:37:02.730Z" title="发表于 2022-11-22 23:37:02">2022-11-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/22/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E7%AE%A1%E7%90%86%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/" title="网络工程课堂笔记"><img src="https://s2.loli.net/2022/11/24/ju4opOa8iZbPgnD.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="网络工程课堂笔记"/></a><div class="content"><a class="title" href="/2022/11/22/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E7%AE%A1%E7%90%86%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/" title="网络工程课堂笔记">网络工程课堂笔记</a><time datetime="2022-11-22T15:37:02.727Z" title="发表于 2022-11-22 23:37:02">2022-11-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/22/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/" title="数据库三天速成CRUD"><img src="https://s2.loli.net/2022/11/24/vuhBnFVdce2xkNA.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据库三天速成CRUD"/></a><div class="content"><a class="title" href="/2022/11/22/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/" title="数据库三天速成CRUD">数据库三天速成CRUD</a><time datetime="2022-11-22T15:37:02.722Z" title="发表于 2022-11-22 23:37:02">2022-11-22</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://s2.loli.net/2022/11/24/FMKDTBpc2faeIJH.png')"><div id="footer-wrap"><div class="copyright">&copy;公元520 - 2022 By Guo·Hugo</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">I wish you to become your own sun, no need to rely on who's light.<p><a target="_blank" href="https://hexo.io/"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为Hexo"></a>&nbsp;<a target="_blank" href="https://butterfly.js.org/"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="主题采用butterfly"></a>&nbsp;<a target="_blank" href="https://www.jsdelivr.com/"><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&logo=jsDelivr" title="本站使用JsDelivr为静态资源提供CDN加速"></a> &nbsp;<a target="_blank" href="https://vercel.com/ "><img src="https://img.shields.io/badge/Hosted-Vervel-brightgreen?style=flat&logo=Vercel" title="本站采用双线部署，默认线路托管于Vercel"></a>&nbsp;<a target="_blank" href="https://vercel.com/ "><img src="https://img.shields.io/badge/Hosted-Coding-0cedbe?style=flat&logo=Codio" title="本站采用双线部署，联通线路托管于Coding"></a>&nbsp;<a target="_blank" href="https://github.com/"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="本站项目由Gtihub托管"></a>&nbsp;<a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="/js/cat.js"></script><script async data-pjax src="/js/anzhiyu.js"></script><script async data-pjax src="/js/anzhiyufunction.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://alist.anzhiy.cn/d/anzhiyu/js/Meting2.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})


document.addEventListener('pjax:send', function () {
  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script></div><div id="nav-music"><div id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()">播放音乐</div><meting-js id="1708664797" server="tencent" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="/js/cat.js"></script><script async data-pjax src="/js/anzhiyu.js"></script><script async data-pjax src="/js/anzhiyufunction.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://alist.anzhiy.cn/d/anzhiyu/js/Meting2.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})


document.addEventListener('pjax:send', function () {
  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = 'b16a1fa0e63c46a4b8f28abfb06ae3fe';
  var gaud_map_key = 'e2b04289e870b005374ee030148d64fd&s=rsv3';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '112.982279,28.19409';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><!-- hexo injector body_end end --></body></html>